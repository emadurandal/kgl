parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"e7Sb":[function(require,module,exports) {
function e(e){if(Array.isArray(e))return e}module.exports=e,module.exports.default=module.exports,module.exports.__esModule=!0;
},{}],"nyVk":[function(require,module,exports) {
function l(l,e){var r=null==l?null:"undefined"!=typeof Symbol&&l[Symbol.iterator]||l["@@iterator"];if(null!=r){var t,o,u=[],n=!0,a=!1;try{for(r=r.call(l);!(n=(t=r.next()).done)&&(u.push(t.value),!e||u.length!==e);n=!0);}catch(d){a=!0,o=d}finally{try{n||null==r.return||r.return()}finally{if(a)throw o}}return u}}module.exports=l,module.exports.default=module.exports,module.exports.__esModule=!0;
},{}],"ixeg":[function(require,module,exports) {
function e(e,o){(null==o||o>e.length)&&(o=e.length);for(var l=0,r=new Array(o);l<o;l++)r[l]=e[l];return r}module.exports=e,module.exports.default=module.exports,module.exports.__esModule=!0;
},{}],"IOZJ":[function(require,module,exports) {
var r=require("./arrayLikeToArray.js");function e(e,t){if(e){if("string"==typeof e)return r(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?r(e,t):void 0}}module.exports=e,module.exports.default=module.exports,module.exports.__esModule=!0;
},{"./arrayLikeToArray.js":"ixeg"}],"yJnk":[function(require,module,exports) {
function e(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}module.exports=e,module.exports.default=module.exports,module.exports.__esModule=!0;
},{}],"xw6J":[function(require,module,exports) {
var e=require("./arrayWithHoles.js"),r=require("./iterableToArrayLimit.js"),o=require("./unsupportedIterableToArray.js"),t=require("./nonIterableRest.js");function u(u,s){return e(u)||r(u,s)||o(u,s)||t()}module.exports=u,module.exports.default=module.exports,module.exports.__esModule=!0;
},{"./arrayWithHoles.js":"e7Sb","./iterableToArrayLimit.js":"nyVk","./unsupportedIterableToArray.js":"IOZJ","./nonIterableRest.js":"yJnk"}],"fwsn":[function(require,module,exports) {
function e(e,o,t,n,r,u,i){try{var d=e[u](i),l=d.value}catch(s){return void t(s)}d.done?o(l):Promise.resolve(l).then(n,r)}function o(o){return function(){var t=this,n=arguments;return new Promise(function(r,u){var i=o.apply(t,n);function d(o){e(i,r,u,d,l,"next",o)}function l(o){e(i,r,u,d,l,"throw",o)}d(void 0)})}}module.exports=o,module.exports.default=module.exports,module.exports.__esModule=!0;
},{}],"KA2S":[function(require,module,exports) {
var define;
var t,r=function(t){"use strict";var r,e=Object.prototype,n=e.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,r,e){return Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{u({},"")}catch(F){u=function(t,r,e){return t[r]=e}}function h(t,r,e,n){var o=r&&r.prototype instanceof g?r:g,i=Object.create(o.prototype),a=new G(n||[]);return i._invoke=function(t,r,e){var n=l;return function(o,i){if(n===p)throw new Error("Generator is already running");if(n===y){if("throw"===o)throw i;return T()}for(e.method=o,e.arg=i;;){var a=e.delegate;if(a){var c=j(a,e);if(c){if(c===v)continue;return c}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if(n===l)throw n=y,e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);n=p;var u=f(t,r,e);if("normal"===u.type){if(n=e.done?y:s,u.arg===v)continue;return{value:u.arg,done:e.done}}"throw"===u.type&&(n=y,e.method="throw",e.arg=u.arg)}}}(t,e,a),i}function f(t,r,e){try{return{type:"normal",arg:t.call(r,e)}}catch(F){return{type:"throw",arg:F}}}t.wrap=h;var l="suspendedStart",s="suspendedYield",p="executing",y="completed",v={};function g(){}function d(){}function m(){}var w={};u(w,i,function(){return this});var L=Object.getPrototypeOf,x=L&&L(L(N([])));x&&x!==e&&n.call(x,i)&&(w=x);var b=m.prototype=g.prototype=Object.create(w);function E(t){["next","throw","return"].forEach(function(r){u(t,r,function(t){return this._invoke(r,t)})})}function _(t,r){var e;this._invoke=function(o,i){function a(){return new r(function(e,a){!function e(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var h=u.arg,l=h.value;return l&&"object"==typeof l&&n.call(l,"__await")?r.resolve(l.__await).then(function(t){e("next",t,a,c)},function(t){e("throw",t,a,c)}):r.resolve(l).then(function(t){h.value=t,a(h)},function(t){return e("throw",t,a,c)})}c(u.arg)}(o,i,e,a)})}return e=e?e.then(a,a):a()}}function j(t,e){var n=t.iterator[e.method];if(n===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=r,j(t,e),"throw"===e.method))return v;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var o=f(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,v;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=r),e.delegate=null,v):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,v)}function O(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function k(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function G(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function N(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function e(){for(;++o<t.length;)if(n.call(t,o))return e.value=t[o],e.done=!1,e;return e.value=r,e.done=!0,e};return a.next=a}}return{next:T}}function T(){return{value:r,done:!0}}return d.prototype=m,u(b,"constructor",m),u(m,"constructor",d),d.displayName=u(m,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===d||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,u(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},E(_.prototype),u(_.prototype,a,function(){return this}),t.AsyncIterator=_,t.async=function(r,e,n,o,i){void 0===i&&(i=Promise);var a=new _(h(r,e,n,o),i);return t.isGeneratorFunction(e)?a:a.next().then(function(t){return t.done?t.value:a.next()})},E(b),u(b,c,"Generator"),u(b,i,function(){return this}),u(b,"toString",function(){return"[object Generator]"}),t.keys=function(t){var r=[];for(var e in t)r.push(e);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,G.prototype={constructor:G,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function o(n,o){return c.type="throw",c.arg=t,e.next=n,o&&(e.method="next",e.arg=r),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),h=n.call(a,"finallyLoc");if(u&&h){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,r){for(var e=this.tryEntries.length-1;e>=0;--e){var o=this.tryEntries[e];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=r&&r<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=r,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),v},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),k(e),v}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var o=n.arg;k(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:N(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=r),v}},t}("object"==typeof module?module.exports:{});try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}
},{}],"m4eR":[function(require,module,exports) {
module.exports=require("regenerator-runtime");
},{"regenerator-runtime":"KA2S"}],"q3Og":[function(require,module,exports) {
"use strict";function t(){return r(new Float32Array(16))}function r(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function e(t,r,e){var n=t[0],o=t[1],u=t[2],a=t[3],s=t[4],i=t[5],c=t[6],p=t[7],f=t[8],x=t[9],v=t[10],l=t[11],M=t[12],h=t[13],q=t[14],y=t[15],d=r[0],A=r[1],P=r[2],_=r[3],b=r[4],j=r[5],k=r[6],m=r[7],w=r[8],F=r[9],I=r[10],O=r[11],g=r[12],z=r[13],B=r[14],C=r[15];return e[0]=d*n+A*s+P*f+_*M,e[1]=d*o+A*i+P*x+_*h,e[2]=d*u+A*c+P*v+_*q,e[3]=d*a+A*p+P*l+_*y,e[4]=b*n+j*s+k*f+m*M,e[5]=b*o+j*i+k*x+m*h,e[6]=b*u+j*c+k*v+m*q,e[7]=b*a+j*p+k*l+m*y,e[8]=w*n+F*s+I*f+O*M,e[9]=w*o+F*i+I*x+O*h,e[10]=w*u+F*c+I*v+O*q,e[11]=w*a+F*p+I*l+O*y,e[12]=g*n+z*s+B*f+C*M,e[13]=g*o+z*i+B*x+C*h,e[14]=g*u+z*c+B*v+C*q,e[15]=g*a+z*p+B*l+C*y,e}function n(t,r,e){return e[0]=t[0]*r[0],e[1]=t[1]*r[0],e[2]=t[2]*r[0],e[3]=t[3]*r[0],e[4]=t[4]*r[1],e[5]=t[5]*r[1],e[6]=t[6]*r[1],e[7]=t[7]*r[1],e[8]=t[8]*r[2],e[9]=t[9]*r[2],e[10]=t[10]*r[2],e[11]=t[11]*r[2],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function o(t,r,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[0]*r[0]+t[4]*r[1]+t[8]*r[2]+t[12],e[13]=t[1]*r[0]+t[5]*r[1]+t[9]*r[2]+t[13],e[14]=t[2]*r[0]+t[6]*r[1]+t[10]*r[2]+t[14],e[15]=t[3]*r[0]+t[7]*r[1]+t[11]*r[2]+t[15],e}function u(t,r,e,n){var o=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);if(!o)return null;var u=e[0],a=e[1],s=e[2];1!==o&&(u*=o=1/o,a*=o,s*=o);var i=Math.sin(r),c=Math.cos(r),p=1-c,f=t[0],x=t[1],v=t[2],l=t[3],M=t[4],h=t[5],q=t[6],y=t[7],d=t[8],A=t[9],P=t[10],_=t[11],b=u*u*p+c,j=a*u*p+s*i,k=s*u*p-a*i,m=u*a*p-s*i,w=a*a*p+c,F=s*a*p+u*i,I=u*s*p+a*i,O=a*s*p-u*i,g=s*s*p+c;return r?t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=f*b+M*j+d*k,n[1]=x*b+h*j+A*k,n[2]=v*b+q*j+P*k,n[3]=l*b+y*j+_*k,n[4]=f*m+M*w+d*F,n[5]=x*m+h*w+A*F,n[6]=v*m+q*w+P*F,n[7]=l*m+y*w+_*F,n[8]=f*I+M*O+d*g,n[9]=x*I+h*O+A*g,n[10]=v*I+q*O+P*g,n[11]=l*I+y*O+_*g,n}function a(t,e,n,o){var u,a,s,i,c,p,f,x,v,l,M=t[0],h=t[1],q=t[2],y=n[0],d=n[1],A=n[2],P=e[0],_=e[1],b=e[2];return M===P&&h===_&&q===b?r(o):(f=M-e[0],x=h-e[1],v=q-e[2],u=d*(v*=l=1/Math.sqrt(f*f+x*x+v*v))-A*(x*=l),a=A*(f*=l)-y*v,s=y*x-d*f,(l=Math.sqrt(u*u+a*a+s*s))?(u*=l=1/l,a*=l,s*=l):(u=0,a=0,s=0),i=x*s-v*a,c=v*u-f*s,p=f*a-x*u,(l=Math.sqrt(i*i+c*c+p*p))?(i*=l=1/l,c*=l,p*=l):(i=0,c=0,p=0),o[0]=u,o[1]=i,o[2]=f,o[3]=0,o[4]=a,o[5]=c,o[6]=x,o[7]=0,o[8]=s,o[9]=p,o[10]=v,o[11]=0,o[12]=-(u*M+a*h+s*q),o[13]=-(i*M+c*h+p*q),o[14]=-(f*M+x*h+v*q),o[15]=1,o)}function s(t,r,e,n,o){var u=e*Math.tan(t*Math.PI/360),a=2*(u*r),s=2*u,i=n-e;return o[0]=2*e/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*e/s,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-(n+e)/i,o[11]=-1,o[12]=0,o[13]=0,o[14]=-n*e*2/i,o[15]=0,o}function i(t,r,e,n,o,u,a){var s=r-t,i=e-n,c=u-o;return a[0]=2/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/c,a[11]=0,a[12]=-(t+r)/s,a[13]=-(e+n)/i,a[14]=-(u+o)/c,a[15]=1,a}function c(t,r){return r[0]=t[0],r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=t[1],r[5]=t[5],r[6]=t[9],r[7]=t[13],r[8]=t[2],r[9]=t[6],r[10]=t[10],r[11]=t[14],r[12]=t[3],r[13]=t[7],r[14]=t[11],r[15]=t[15],r}function p(t,r){var e=t[0],n=t[1],o=t[2],u=t[3],a=t[4],s=t[5],i=t[6],c=t[7],p=t[8],f=t[9],x=t[10],v=t[11],l=t[12],M=t[13],h=t[14],q=t[15],y=e*s-n*a,d=e*i-o*a,A=e*c-u*a,P=n*i-o*s,_=n*c-u*s,b=o*c-u*i,j=p*M-f*l,k=p*h-x*l,m=p*q-v*l,w=f*h-x*M,F=f*q-v*M,I=x*q-v*h,O=1/(y*I-d*F+A*w+P*m-_*k+b*j);return r[0]=(s*I-i*F+c*w)*O,r[1]=(-n*I+o*F-u*w)*O,r[2]=(M*b-h*_+q*P)*O,r[3]=(-f*b+x*_-v*P)*O,r[4]=(-a*I+i*m-c*k)*O,r[5]=(e*I-o*m+u*k)*O,r[6]=(-l*b+h*A-q*d)*O,r[7]=(p*b-x*A+v*d)*O,r[8]=(a*F-s*m+c*j)*O,r[9]=(-e*F+n*m-u*j)*O,r[10]=(l*_-M*A+q*y)*O,r[11]=(-p*_+f*A-v*y)*O,r[12]=(-a*w+s*k-i*j)*O,r[13]=(e*w-n*k+o*j)*O,r[14]=(-l*P+M*d-h*y)*O,r[15]=(p*P-f*d+x*y)*O,r}Object.defineProperty(exports,"__esModule",{value:!0}),exports.createMatrix=t,exports.identity=r,exports.multiply=e,exports.scale=n,exports.translate=o,exports.rotate=u,exports.lookAt=a,exports.perspective=s,exports.ortho=i,exports.transpose=c,exports.inverse=p;
},{}],"XCtE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("./minMatrix.js");function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function r(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),t}var s={none:"attribute vec2 aPosition;void main(){gl_Position=vec4(aPosition,0.,1.);}",plane:"\n    attribute vec3 aPosition;\n    attribute vec2 aUv;\n    uniform mat4 uMvpMatrix;\n    varying vec2 vUv;\n    void main() {\n      vUv = aUv;\n      gl_Position = uMvpMatrix * vec4(aPosition, 1.);\n    }\n  "},n={aPosition:{value:[-1,1,-1,-1,1,1,1,-1],size:2}};function o(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)/2,e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)/2;return{aPosition:{value:[-t,e,0,-t,-e,0,t,e,0,t,-e,0],size:3},aUv:{value:[0,1,0,0,1,1,1,0],size:2}}}var u=function(){function a(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,a),this.attributes={},this.uniforms={},this.textures={},this.mMatrix=(0,t.createMatrix)(),this.mvpMatrix=(0,t.createMatrix)(),this.invMatrix=(0,t.createMatrix)(),this.translateValue=[0,0,0],this.scaleValue=[1,1,1],this.rotateValue=[0,0,0],this.widthValue=1,this.heightValue=1,this.isUpdateMatrixUniform=!1;var u=e.gl;this.kgl=e,this.gl=u;var h=r.name,l=r.shape,c=r.vertexShaderId,d=r.vertexShader,f=void 0===d?c?document.getElementById(c).textContent:l?s[l]:s.none:d,v=r.fragmentShaderId,m=r.fragmentShader,g=void 0===m?document.getElementById(v).textContent:m,E=r.attributes,x=r.instancedAttributes,b=r.uniforms,A=r.mode,y=r.drawType,T=void 0===y?"STATIC_DRAW":y,M=r.isTransparent,p=void 0!==M&&M,R=r.isAdditive,_=void 0!==R&&R,U=r.isFloats,S=void 0!==U&&U,k=r.isCulling,C=void 0===k||k,I=r.isDepth,L=void 0!==I&&I,V=r.clearedColor,P=!S,F=r.isAutoResolution,D=void 0===F?(!b||!b.uResolution)&&P:F,B=r.hasCamera,N=void 0===B?P:B,w=r.hasLight,O=void 0===w?P:w,G=r.isClear,X=void 0===G?P:G,j=!(r.shape||r.vertexShaderId||r.vertexShader);if(this.name=h,this.mode=A,this.glMode=u[A||"TRIANGLE_STRIP"],this.drawType=T,this.isTransparent=p,this.isAdditive=_,this.isAutoResolution=D,this.hasCamera=N,this.hasLight=O,this.isClear=X,this.isCulling=C,this.isDepth=L,this.isInstanced=x,this.clearedColor=V||[0,0,0,0],this.createProgram(f,g),this.use(),j)this.createAttribute(n);else if(l)switch(l){case"plane":this.width=r.width,this.height=r.height,this.createAttribute(o())}else if(E&&(this.createAttribute(E),this.isInstanced)){if(this.instancedArraysExt=u.getExtension("ANGLE_instanced_arrays"),null==this.instancedArraysExt)return void alert("ANGLE_instanced_arrays not supported");this.createAttribute(x,!0)}b&&this.createUniform(b)}return r(a,[{key:"createProgram",value:function(t,e){var i=this.gl,a=i.createProgram();i.attachShader(a,this.vertexShader=this.createShader("VERTEX_SHADER",t)),i.attachShader(a,this.fragmentShader=this.createShader("FRAGMENT_SHADER",e)),i.linkProgram(a),i.getProgramParameter(a,i.LINK_STATUS)?a?this.program=a:console.error('Failed to create program "'.concat(this.name,'".')):console.error(i.getProgramInfoLog(a))}},{key:"createShader",value:function(t,e){var i=this.gl,a=i.createShader(i[t]);if(i.shaderSource(a,e),i.compileShader(a),i.getShaderParameter(a,i.COMPILE_STATUS))return a;console.error(i.getShaderInfoLog(a))}},{key:"createAttribute",value:function(t,e){var i=this;Object.keys(t).forEach(function(a){var r=t[a],s=r.value,n=r.size,o=r.isIndices;i.addAttribute(a,s,n,o,e)})}},{key:"addAttribute",value:function(t,e,i,a,r){var s=this.gl,n=s.getAttribLocation(this.program,t),o=this.attributes[t]={location:n,size:i,isInstanced:r};if(a){var u=s.createBuffer();s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,u),s.bufferData(s.ELEMENT_ARRAY_BUFFER,new Int16Array(e),s[this.drawType]),o.ibo=u,this.indicesCount=this.indicesCount||e.length,this.glMode=s[this.mode||"TRIANGLES"]}else{var h=s.createBuffer();s.bindBuffer(s.ARRAY_BUFFER,h),s.bufferData(s.ARRAY_BUFFER,new Float32Array(e),s[this.drawType]),o.vbo=h,r&&(this.instanceCount=this.instanceCount||e.length/i),this.count=this.count||e.length/i}}},{key:"setAttribute",value:function(t){var e=this.gl,i=this.attributes[t],a=i.location,r=i.size,s=i.vbo,n=i.ibo,o=i.isInstanced;n?e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n):(e.bindBuffer(e.ARRAY_BUFFER,s),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,r,e.FLOAT,!1,0,0),o&&this.instancedArraysExt.vertexAttribDivisorANGLE(a,1))}},{key:"updateAttribute",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,this.attributes[t].vbo),a.bufferSubData(a.ARRAY_BUFFER,i,new Float32Array(e))}},{key:"width",get:function(){return this.widthValue},set:function(t){this.widthValue=t,this.updateMatrix()}},{key:"height",get:function(){return this.heightValue},set:function(t){this.heightValue=t,this.updateMatrix()}},{key:"x",get:function(){return this.translateValue[0]},set:function(t){this.translateValue[0]=t,this.updateMatrix()}},{key:"y",get:function(){return this.translateValue[1]},set:function(t){this.translateValue[1]=t,this.updateMatrix()}},{key:"z",get:function(){return this.translateValue[2]},set:function(t){this.translateValue[2]=t,this.updateMatrix()}},{key:"scale",get:function(){return this.scaleValue[0]===this.scaleValue[1]===this.scaleValue[2]?this.scaleValue[0]:null},set:function(t){this.scaleValue[0]=this.scaleValue[1]=this.scaleValue[2]=t,this.updateMatrix()}},{key:"scaleX",get:function(){return this.scaleValue[0]},set:function(t){this.scaleValue[0]=t,this.updateMatrix()}},{key:"scaleY",get:function(){return this.scaleValue[1]},set:function(t){this.scaleValue[1]=t,this.updateMatrix()}},{key:"scaleZ",get:function(){return this.scaleValue[2]},set:function(t){this.scaleValue[2]=t,this.updateMatrix()}},{key:"rotateX",get:function(){return this.rotateValue[0]},set:function(t){this.rotateValue[0]=t,this.updateMatrix()}},{key:"rotateY",get:function(){return this.rotateValue[1]},set:function(t){this.rotateValue[1]=t,this.updateMatrix()}},{key:"updateMatrix",value:function(){this.isUpdateMatrixUniform=!0}},{key:"updateMatrixUniform",value:function(){(0,t.identity)(this.mMatrix),(0,t.translate)(this.mMatrix,this.translateValue,this.mMatrix),(0,t.rotate)(this.mMatrix,this.rotateValue[0],[1,0,0],this.mMatrix),(0,t.rotate)(this.mMatrix,this.rotateValue[1],[0,1,0],this.mMatrix),(0,t.scale)(this.mMatrix,[this.width*this.scaleValue[0],this.height*this.scaleValue[1],this.scaleValue[2]],this.mMatrix),(0,t.multiply)(this.kgl.vpMatrix,this.mMatrix,this.mvpMatrix),(0,t.inverse)(this.mMatrix,this.invMatrix),this.uniforms.uMvpMatrix=this.mvpMatrix,this.uniforms.uInvMatrix=this.invMatrix}},{key:"createUniform",value:function(t){var e=this,i=Object.assign({},t);this.isAutoResolution&&!i.uResolution&&(i.uResolution=[1,1]),this.hasCamera&&(i.uMvpMatrix=new Float32Array(16),i.uInvMatrix=new Float32Array(16)),this.hasLight&&(i.uLightDirection||(i.uLightDirection=[0,0,0]),i.uEyeDirection||(i.uEyeDirection=[0,0,0]),i.uAmbientColor||(i.uAmbientColor=[.1,.1,.1])),Object.keys(i).forEach(function(t){e.addUniform(t,i[t])})}},{key:"addUniform",value:function(t,i){var a,r,s=this,n=i,o=function(e,i){switch(e){case"image":a="image",r="1i",n=s.createTexture(t,i);break;case"framebuffer":a="framebuffer",r="1i",n=i;break;default:r=e,n=i}};switch(e(i)){case"number":r="1f";break;case"boolean":r="1i";break;case"string":o(i);break;case"object":switch(i.constructor.name){case"Float32Array":case"Array":switch(i.length){case 16:a="matrix",r="Matrix4fv";break;default:r="".concat(i.length,"fv")}break;case"HTMLImageElement":case"HTMLVideoElement":case"HTMLCanvasElement":r="1i",n=this.createTexture(t,i);break;case"Object":o(i.type,i.value)}}if(r){var u,h=this.gl.getUniformLocation(this.program,t),l="uniform".concat(r);switch(a){case"image":u=function(t){s.gl[l](h,s.textures[t].textureIndex),n=t};break;case"framebuffer":u=function(t){s.gl[l](h,s.kgl.framebuffers[t].textureIndex),n=t};break;case"matrix":u=function(t){s.gl[l](h,!1,t),n=t};break;default:u=function(t){s.gl[l](h,t),n=t}}Object.defineProperty(this.uniforms,t,{get:function(){return n},set:u}),void 0!==n&&(this.uniforms[t]=n)}else console.error('Failed to add uniform "'.concat(t,'".'))}},{key:"updateUniforms",value:function(t){for(var e=Object.keys(t),i=0;i<e.length;i++){var a=e[i];this.uniforms[a]=t[a]}}},{key:"createTexture",value:function(t,e){if(e){var i=this.gl,a=i.createTexture(),r=++this.kgl.textureIndex;return this.textures[t]={texture:a,textureIndex:r},i.activeTexture(i["TEXTURE".concat(r)]),i.bindTexture(i.TEXTURE_2D,a),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e),r}}},{key:"updateTexture",value:function(t,e){var i=this.gl;i.activeTexture(i["TEXTURE".concat(this.textures[t].textureIndex)]),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e)}},{key:"use",value:function(){this.gl.useProgram(this.program)}},{key:"draw",value:function(){var t=this.gl;this.use(),this.isClear&&(t.clearColor(this.clearedColor[0],this.clearedColor[1],this.clearedColor[2],this.clearedColor[3]),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)),this.isTransparent?(t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA)):this.isAdditive?(t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE,t.ONE,t.ONE)):t.disable(t.BLEND),this.isCulling?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.isDepth?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.isUpdateMatrixUniform&&(this.updateMatrixUniform(),this.isUpdateMatrixUniform=!1);for(var e=Object.keys(this.attributes),i=0;i<e.length;i++)this.setAttribute(e[i]);this.isInstanced?this.indicesCount?this.instancedArraysExt.drawElementsInstancedANGLE(this.glMode,this.indicesCount,t.UNSIGNED_SHORT,0,this.instanceCount):this.instancedArraysExt.drawArraysInstancedANGLE(this.glMode,0,this.count,this.instanceCount):this.indicesCount?t.drawElements(this.glMode,this.indicesCount,t.UNSIGNED_SHORT,0):t.drawArrays(this.glMode,0,this.count)}},{key:"destroy",value:function(){var t=this,e=this.gl;e.deleteShader(this.vertexShader),e.deleteShader(this.fragmentShader),Object.keys(this.attributes).forEach(function(i){var a=t.attributes[i],r=a.vbo,s=a.ibo;e.deleteBuffer(r||s)}),Object.keys(this.textures).forEach(function(i){var a=t.textures[i].texture;e.deleteTexture(a)}),e.deleteProgram(this.program)}}]),a}();exports.default=u;
},{"./minMatrix.js":"q3Og"}],"gGhW":[function(require,module,exports) {
module.exports="precision highp float;\n#define GLSLIFY 1\n\nuniform vec2 uResolution;\nuniform sampler2D uTexture;\n\nvoid main() {\n  gl_FragColor = texture2D(uTexture, gl_FragCoord.st / uResolution);\n}\n";
},{}],"f5B0":[function(require,module,exports) {
module.exports="precision highp float;\n#define GLSLIFY 1\n\nuniform sampler2D uTexture;\nuniform vec2 uResolution;\nuniform float uRadius;\nuniform bool uIsHorizontal;\n\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main () {\n  vec2 uv = gl_FragCoord.xy / uResolution;\n  vec2 direction = uIsHorizontal ? vec2(1., 0.) : vec2(0., 1.);\n  direction *= uRadius;\n  gl_FragColor = blur9(uTexture, uv, uResolution, direction);\n}\n";
},{}],"aPJu":[function(require,module,exports) {
module.exports="precision highp float;\n#define GLSLIFY 1\n\nuniform vec2 uResolution;\nuniform sampler2D uTexture;\nuniform float uThreshold;\n\nvoid main() {\n  vec2 uv = gl_FragCoord.st / uResolution;\n  vec4 color = texture2D(uTexture, uv);\n  if (color.a == 0. || length(color.rgb) < uThreshold * 1.732) discard;\n  gl_FragColor = color;\n}\n";
},{}],"iAUv":[function(require,module,exports) {
module.exports="precision highp float;\n#define GLSLIFY 1\n\nuniform vec2 uResolution;\nuniform sampler2D uSpecular;\n\nconst float brightness = 0.7;\nconst float spread = 0.3;\n\nvoid main() {\n  vec2 uv = gl_FragCoord.st / uResolution;\n  vec4 specularColor = texture2D(uSpecular, uv);\n  specularColor.rgb = pow(specularColor.rgb, vec3(1. - brightness));\n  specularColor.a = pow(specularColor.a, 1. - spread);\n  gl_FragColor = specularColor;\n  // gl_FragColor = vec4(vec3(specularColor.a), 1.); // * debug\n  // gl_FragColor = vec4(texture2D(uSpecular, uv).rgb, 1.); // * debug\n}\n";
},{}],"KuNS":[function(require,module,exports) {
module.exports="precision highp float;\n#define GLSLIFY 1\n\nuniform sampler2D uTexture;\nuniform vec2 uResolution;\nuniform float uStrength;\nuniform vec2 uCenter;\n\nhighp float random(vec2 co)\n{\n    highp float a = 12.9898;\n    highp float b = 78.233;\n    highp float c = 43758.5453;\n    highp float dt= dot(co.xy ,vec2(a,b));\n    highp float sn= mod(dt,3.14);\n    return fract(sin(sn) * c);\n}\n\nconst float nFrag = 1. / 30.;\n\nvoid main () {\n  vec2 tFrag = 1. / uResolution;\n  vec3 destColor = vec3(0.);\n  float randomValue = random(vec2(12.9898, 78.233));\n  vec2 fc = gl_FragCoord.st;\n  vec2 fcc = fc - uCenter;\n  float totalWeight = 0.;\n\n  for (float i = 0.; i <= 30.; i++) {\n    float percent = (i + randomValue) * nFrag;\n    float weight = percent - percent * percent;\n    vec2 t = fc - fcc * percent * uStrength * nFrag;\n    destColor += texture2D(uTexture, t * tFrag).rgb * weight;\n    totalWeight += weight;\n  }\n  gl_FragColor = vec4(destColor / totalWeight, 1.);\n}\n";
},{}],"avE6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GodrayLight=exports.Godray=exports.Zoomblur=exports.Bloom=exports.Specular=exports.Blur=void 0;var e=f(require("./program")),r=f(require("./shaders/template/texture.frag")),t=f(require("./shaders/postprocessing/blur.frag")),o=f(require("./shaders/postprocessing/specular.frag")),u=f(require("./shaders/postprocessing/bloom.frag")),a=f(require("./shaders/postprocessing/zoomblur.frag"));function f(e){return e&&e.__esModule?e:{default:e}}function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function i(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e,r,t){return r&&i(e.prototype,r),t&&i(e,t),e}function c(e,r,t){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,r,t){var o=d(e,r);if(o){var u=Object.getOwnPropertyDescriptor(o,r);return u.get?u.get.call(t):u.value}})(e,r,t||e)}function d(e,r){for(;!Object.prototype.hasOwnProperty.call(e,r)&&null!==(e=v(e)););return e}function h(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&p(e,r)}function p(e,r){return(p=Object.setPrototypeOf||function(e,r){return e.__proto__=r,e})(e,r)}function m(e){var r=b();return function(){var t,o=v(e);if(r){var u=v(this).constructor;t=Reflect.construct(o,arguments,u)}else t=o.apply(this,arguments);return y(this,t)}}function y(e,r){if(r&&("object"===n(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return g(e)}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var w=function(r){h(u,e.default);var o=m(u);function u(e){var r;s(this,u);var a={fragmentShader:t.default,uniforms:{uTexture:"framebuffer",uRadius:0,uIsHorizontal:!1},hasCamera:!1,hasLight:!1};return(r=o.call(this,e,a)).radius=.5,r}return l(u,[{key:"draw",value:function(e,r,t,o){this.use();for(var a=0;a<8;a++){this.kgl.bindFramebuffer(o&&a>=7?null:r),this.uniforms.uTexture=e,this.uniforms.uRadius=(7-a)*(void 0!==t?t:this.radius),this.uniforms.uIsHorizontal=a%2==0,c(v(u.prototype),"draw",this).call(this);var f=r;r=e,e=f}}}]),u}();exports.Blur=w;var x=function(r){h(u,e.default);var t=m(u);function u(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s(this,u);var a=r.threshold,f=void 0===a?.5:a,n={fragmentShader:o.default,uniforms:{uTexture:"framebuffer",uThreshold:f},hasCamera:!1,hasLight:!1};return t.call(this,e,n)}return l(u,[{key:"draw",value:function(e,r,t){this.kgl.bindFramebuffer(r),this.use(),this.uniforms.uTexture=e,void 0!==t&&(this.uniforms.uThreshold=t),c(v(u.prototype),"draw",this).call(this)}}]),u}();exports.Specular=x;var S=function(t){h(a,e.default);var o=m(a);function a(t){var f;s(this,a),t.effects.bloomSpecular||(t.effects.bloomSpecular=new x(t,{threshold:.3})),t.effects.bloomBlur||(t.effects.bloomBlur=new w(t)),t.effects.bloomBase||(t.effects.bloomBase=new e.default(t,{fragmentShader:r.default,uniforms:{uTexture:"framebuffer"}}));var n={fragmentShader:u.default,uniforms:{uSpecular:"framebuffer"},isAdditive:!0,hasCamera:!1,hasLight:!1,isClear:!1};return(f=o.call(this,t,n)).radius=.4,f}return l(a,[{key:"draw",value:function(e,r,t,o,u){this.kgl.effects.bloomSpecular.draw(e,r),this.kgl.effects.bloomBlur.draw(r,t,void 0!==o?o:this.radius),this.kgl.bindFramebuffer(u?null:t);var f=this.kgl.effects.bloomBase;f.use(),f.uniforms.uTexture=e,f.draw(),this.use(),this.uniforms.uSpecular=r,c(v(a.prototype),"draw",this).call(this)}}]),a}();exports.Bloom=S;var k=function(r){h(o,e.default);var t=m(o);function o(e){s(this,o);var r={fragmentShader:a.default,uniforms:{uTexture:"framebuffer",uStrength:5,uCenter:[e.canvas.width/2,e.canvas.height/2]}};return t.call(this,e,r)}return l(o,[{key:"draw",value:function(e,r,t,u,a){this.kgl.bindFramebuffer(a?null:r),this.use(),this.uniforms.uTexture=e,void 0!==t&&(this.uniforms.uStrength=t),void 0!==u&&(this.uniforms.uCenter=u),c(v(o.prototype),"draw",this).call(this)}}]),o}();exports.Zoomblur=k;var B=function(t){h(u,e.default);var o=m(u);function u(t){var a;s(this,u),t.effects.godraySpecular||(t.effects.godraySpecular=new x(t,{threshold:.75})),t.effects.godrayZoomblur||(t.effects.godrayZoomblur=new k(t)),t.effects.godrayBlur||(t.effects.godrayBlur=new w(t)),t.effects.godrayBase||(t.effects.godrayBase=new e.default(t,{fragmentShader:r.default,uniforms:{uTexture:"framebuffer"}}));var f={fragmentShader:r.default,uniforms:{uTexture:"framebuffer"},isAdditive:!0,isClear:!1};return(a=o.call(this,t,f)).radius=.02,a}return l(u,[{key:"draw",value:function(e,r,t,o,a,f,n){this.kgl.effects.godraySpecular.draw(e,t),this.kgl.effects.godrayZoomblur.draw(t,r,o,a),this.kgl.effects.godrayBlur.draw(r,t,void 0!==f?f:this.radius),this.kgl.bindFramebuffer(n?null:t);var s=this.kgl.effects.godrayBase;s.use(),s.uniforms.uTexture=e,s.draw(),this.use(),this.uniforms.uTexture=r,c(v(u.prototype),"draw",this).call(this)}}]),u}();exports.Godray=B;var T=function(t){h(u,e.default);var o=m(u);function u(e){var t;s(this,u),e.effects.godraySpecular||(e.effects.godraySpecular=new x(e,{threshold:.75})),e.effects.godrayZoomblur||(e.effects.godrayZoomblur=new k(e)),e.effects.godrayBlur||(e.effects.godrayBlur=new w(e));var a={fragmentShader:r.default,uniforms:{uTexture:"framebuffer"},isAdditive:!0,isClear:!1};return(t=o.call(this,e,a)).radius=.02,t}return l(u,[{key:"draw",value:function(e,r,t,o,a,f,n){this.kgl.effects.godraySpecular.draw(e,t),this.kgl.effects.godrayZoomblur.draw(t,r,o,a),this.kgl.effects.godrayBlur.draw(r,t,void 0!==f?f:this.radius),this.kgl.bindFramebuffer(n?null:t),this.use(),this.uniforms.uTexture=r,c(v(u.prototype),"draw",this).call(this)}}]),u}();exports.GodrayLight=T;
},{"./program":"XCtE","./shaders/template/texture.frag":"gGhW","./shaders/postprocessing/blur.frag":"f5B0","./shaders/postprocessing/specular.frag":"aPJu","./shaders/postprocessing/bloom.frag":"iAUv","./shaders/postprocessing/zoomblur.frag":"KuNS"}],"uBxZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("./minMatrix.js"),t=n(require("./program")),r=a(require("./effects"));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function a(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var a={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=n?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(a,s,o):a[s]=e[s]}return a.default=e,r&&r.set(e,a),a}function n(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,t,r){return t&&f(e.prototype,t),r&&f(e,r),e}var c=function(){function i(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,i),this.programs={},this.programId=-1,this.effects={},this.framebuffers={},this.textureIndex=-1,this.ticks=[],this.vMatrix=(0,e.createMatrix)(),this.pMatrix=(0,e.createMatrix)(),this.vpMatrix=(0,e.createMatrix)();var a=r.canvas,n=r.fov,s=void 0===n?50:n,f=r.near,u=void 0===f?.1:f,c=r.far,h=void 0===c?2e3:c,l=r.cameraPosition,E=void 0===l?[0,0,30]:l,m=r.cameraRotation,d=void 0===m?[0,0]:m,v=r.lightDirection,R=void 0===v?[-1,1,1]:v,b=r.eyeDirection,T=void 0===b?E:b,F=r.ambientColor,p=void 0===F?[.1,.1,.1]:F,y=r.isClear,_=void 0!==y&&y,g=r.clearedColor,x=r.programs,A=void 0===x?{}:x,D=r.effects,U=void 0===D?[]:D,M=r.framebuffers,k=void 0===M?[]:M,O=r.framebufferFloats,P=void 0===O?{}:O,C=r.tick,B=r.onBefore,I=r.onResize,w=r.isAutoResize,L=void 0!==w&&w,X=r.isAutoStart,N=void 0!==X&&X;switch(this._initWebgl(a),this.fov=s,this.near=u,this.far=h,this.cameraPosition=E,this.cameraRotation=d,this.isAutoUpdateCameraPositionZ=void 0===r.cameraPosition,this.lightDirection=R,this.eyeDirection=T,this.ambientColor=p,"function"==typeof C&&this.addTick(C),this.onResize=I,this.isClear=_,this.clearedColor=this.isClear?g||[0,0,0,0]:null,Object.keys(A).forEach(function(e){var r=A[e];"name"in r||(r.name=e),t.createProgram(r)}),U.forEach(function(e){t.createEffect(e)}),L&&this._initResize(),k.constructor.name){case"Array":k.forEach(function(e){t.createFramebuffer(e)});break;case"Object":Object.keys(k).forEach(function(e){var r=k[e],i=r.width,a=r.height;t.createFramebuffer(e,i,a)})}Object.keys(P).forEach(function(e){var r=P[e],i=r.width,a=r.height;t.createFramebufferFloat(e,i,a)}),"function"==typeof B&&B(this),N&&this.start()}return u(i,[{key:"_initWebgl",value:function(e){"string"==typeof e?this.canvas=document.querySelector(e):"object"===s(e)&&"HTMLCanvasElement"===e.constructor.name?this.canvas=e:(this.canvas=document.createElement("canvas"),this.canvas.style.display="block",this.canvas.style.width="100%",this.canvas.style.height="100%",document.body.appendChild(this.canvas));var t=this.gl=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl");t.depthFunc(t.LEQUAL)}},{key:"createProgram",value:function(e){return e.name=e.name||++this.programId,this.programs[e.name]=new t.default(this,e)}},{key:"createEffect",value:function(e){var t=e.charAt(0).toUpperCase()+e.slice(1);this.effects[e]=new r[t](this)}},{key:"createFramebuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.canvas.width,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.canvas.height,i=this.gl,a=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,a);var n=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,n),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,t,r),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,n);var s=i.createTexture(),o=++this.textureIndex;i.activeTexture(i["TEXTURE".concat(o)]),i.bindTexture(i.TEXTURE_2D,s),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,r,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,s,0),i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null),this.framebuffers[e]={framebuffer:a,textureIndex:o,texture:s,depthRenderBuffer:n}}},{key:"resizeFramebuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.canvas.width,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.canvas.height,i=this.gl,a=this.framebuffers[e],n=a.framebuffer,s=a.textureIndex,o=a.depthRenderBuffer;a.isFloat||(i.bindFramebuffer(i.FRAMEBUFFER,n),i.bindRenderbuffer(i.RENDERBUFFER,o),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,t,r),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,o),i.activeTexture(i["TEXTURE".concat(s)]),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,r,0,i.RGBA,i.UNSIGNED_BYTE,null))}},{key:"createFramebufferFloat",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,i=this.gl,a=i.getExtension("OES_texture_float"),n=i.getExtension("OES_texture_half_float");if(a||n){var s=a?i.FLOAT:n.HALF_FLOAT_OES,o=i.createFramebuffer(),f=i.createTexture(),u=++this.textureIndex;i.bindFramebuffer(i.FRAMEBUFFER,o),i.activeTexture(i["TEXTURE".concat(u)]),i.bindTexture(i.TEXTURE_2D,f),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,r,0,i.RGBA,s,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,f,0),i.bindFramebuffer(i.FRAMEBUFFER,null),this.framebuffers[e]={framebuffer:o,textureIndex:u,texture:f,isFloat:!0}}else console.error("float texture not support")}},{key:"bindFramebuffer",value:function(e){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e?this.framebuffers[e].framebuffer:null)}},{key:"unbindFramebuffer",value:function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null)}},{key:"resize",value:function(){var e=this,t=this.gl,r=this.canvas.clientWidth,i=this.canvas.clientHeight;this.canvas.width=r,this.canvas.height=i,this.aspect=r/i,t.viewport(0,0,r,i),Object.keys(this.programs).forEach(function(t){var a=e.programs[t];a.isAutoResolution&&(a.use(),a.uniforms.uResolution=[r,i])}),Object.keys(this.effects).forEach(function(t){var a=e.effects[t];a.isAutoResolution&&(a.use(),a.uniforms.uResolution=[r,i])}),Object.keys(this.framebuffers).forEach(function(t){e.resizeFramebuffer(t)}),this.updateCamera(),this.updateLight(),"function"==typeof this.onResize&&this.onResize(this)}},{key:"_initResize",value:function(){this.resize(),this._resize=this.resize.bind(this),window.addEventListener("resize",this._resize)}},{key:"updateCamera",value:function(){var t=this,r=this.fov,i=this.near,a=this.far,n=this.cameraPosition,s=this.cameraRotation,o=this.vMatrix,f=this.pMatrix,u=this.vpMatrix;this.isAutoUpdateCameraPositionZ&&(n[2]=Math.min(this.canvas.width,this.canvas.height)/2/Math.tan(this.fov/2*(Math.PI/180))),this.eyeDirection=n,(0,e.lookAt)(n,[n[0],n[1],0],[0,1,0],o),(0,e.perspective)(r,this.aspect,i,a,f),s[0]=s[0]%(2*Math.PI),s[1]=s[1]%(2*Math.PI),(0,e.rotate)(o,s[0],[0,1,0],o),(0,e.rotate)(o,s[1],[-1,0,0],o),(0,e.multiply)(f,o,u),Object.keys(this.programs).forEach(function(e){var r=t.programs[e];r.hasCamera&&r.updateMatrix()})}},{key:"updateLight",value:function(){var e=this,t=this.lightDirection,r=this.eyeDirection,i=this.ambientColor;Object.keys(this.programs).forEach(function(a){var n=e.programs[a];n.hasLight&&(n.use(),n.uniforms.uLightDirection=t,n.uniforms.uEyeDirection=r,n.uniforms.uAmbientColor=i)})}},{key:"clear",value:function(){if(this.isClear){var e=this.gl;e.clearColor(this.clearedColor[0],this.clearedColor[1],this.clearedColor[2],this.clearedColor[3]),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}}},{key:"drawAll",value:function(){var e=this;this.clear(),Object.keys(this.programs).forEach(function(t){e.programs[t].draw()})}},{key:"addTick",value:function(e){this.ticks.push(e)}},{key:"start",value:function(){var e,t=this;requestAnimationFrame(function(t){e=t});this.requestID=requestAnimationFrame(function r(i){var a=(i-e)/1e3;t.clear();for(var n=0;n<t.ticks.length;n++)t.ticks[n](t,a);t.requestID=requestAnimationFrame(r)})}},{key:"stop",value:function(){this.requestID&&(cancelAnimationFrame(this.requestID),this.requestID=null)}},{key:"destroy",value:function(){var e,t=this,r=this.gl;this.stop(),window.removeEventListener("resize",this._resize),Object.keys(this.framebuffers).forEach(function(e){var i=t.framebuffers[e],a=i.framebuffer,n=i.texture,s=i.depthRenderBuffer;r.deleteFramebuffer(a),r.deleteTexture(n),s&&r.deleteRenderbuffer(s)}),Object.keys(this.programs).forEach(function(e){t.programs[e].destroy()}),null===(e=r.getExtension("WEBGL_lose_context"))||void 0===e||e.loseContext()}}]),i}();exports.default=c;
},{"./minMatrix.js":"q3Og","./program":"XCtE","./effects":"avE6"}],"LNzP":[function(require,module,exports) {
function o(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(module.exports=o=function(o){return typeof o},module.exports.default=module.exports,module.exports.__esModule=!0):(module.exports=o=function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},module.exports.default=module.exports,module.exports.__esModule=!0),o(e)}module.exports=o,module.exports.default=module.exports,module.exports.__esModule=!0;
},{}],"FOZT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.loadImage=t,exports.mix=n;var e=r(require("@babel/runtime/helpers/typeof"));function r(e){return e&&e.__esModule?e:{default:e}}function t(r,t){"object"===(0,e.default)(r)&&"Array"===r.constructor.name||(r=[r]);var n=[];return r.forEach(function(e){var r=document.createElement("img");n.push(new Promise(function(e){r.addEventListener("load",function(){e(r)})})),t&&(r.crossOrigin="anonymous"),r.src=e}),Promise.all(n)}function n(e,r,t){return e*(1-t)+r*t}
},{"@babel/runtime/helpers/typeof":"LNzP"}],"it9j":[function(require,module,exports) {
"use strict";var e=s(require("@babel/runtime/helpers/slicedToArray")),r=s(require("@babel/runtime/helpers/asyncToGenerator")),t=s(require("@babel/runtime/regenerator")),a=s(require("../../src/index.js")),i=require("../utils.js");function s(e){return e&&e.__esModule?e:{default:e}}function n(){return u.apply(this,arguments)}function u(){return(u=(0,r.default)(t.default.mark(function r(){var s,n,u,c,o,f,m;return t.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return"https://images.unsplash.com/photo-1551467013-ebce6eacb3ed?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=800&fit=max&ixid=eyJhcHBfaWQiOjE0NTg5fQ",s=1.5,n=12,u=window.innerWidth<768?.4:.8,c=.1,r.next=7,(0,i.loadImage)("https://images.unsplash.com/photo-1551467013-ebce6eacb3ed?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=800&fit=max&ixid=eyJhcHBfaWQiOjE0NTg5fQ",!0);case 7:o=r.sent,f=(0,e.default)(o,1),m=f[0],new a.default({programs:{mask:{fragmentShaderId:"mask",uniforms:{uImage:m,uImageResolution:[m.width,m.height]}}},effects:["godray"],framebuffers:["mask","cache","output"],tick:function(e,r){var t=.5*Math.sin(r*s)+.5,a=1-Math.abs(2*t-1);e.bindFramebuffer("mask"),e.programs.mask.draw(),e.effects.godray.draw("mask","cache","output",n,[(0,i.mix)(e.canvas.width,0,t),.5*e.canvas.height],(0,i.mix)(u,c,a),!0)},isAutoResize:!0,isAutoStart:!0});case 11:case"end":return r.stop()}},r)}))).apply(this,arguments)}n();
},{"@babel/runtime/helpers/slicedToArray":"xw6J","@babel/runtime/helpers/asyncToGenerator":"fwsn","@babel/runtime/regenerator":"m4eR","../../src/index.js":"uBxZ","../utils.js":"FOZT"}]},{},["it9j"], null)