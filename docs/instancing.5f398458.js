parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"Je5E":[function(require,module,exports) {
"use strict";function t(){return r(new Float32Array(16))}function r(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function e(t,r,e){var n=t[0],o=t[1],u=t[2],a=t[3],s=t[4],i=t[5],c=t[6],p=t[7],f=t[8],x=t[9],l=t[10],v=t[11],h=t[12],M=t[13],d=t[14],q=t[15],y=r[0],m=r[1],g=r[2],A=r[3],P=r[4],S=r[5],_=r[6],b=r[7],j=r[8],k=r[9],w=r[10],z=r[11],F=r[12],I=r[13],L=r[14],O=r[15];return e[0]=y*n+m*s+g*f+A*h,e[1]=y*o+m*i+g*x+A*M,e[2]=y*u+m*c+g*l+A*d,e[3]=y*a+m*p+g*v+A*q,e[4]=P*n+S*s+_*f+b*h,e[5]=P*o+S*i+_*x+b*M,e[6]=P*u+S*c+_*l+b*d,e[7]=P*a+S*p+_*v+b*q,e[8]=j*n+k*s+w*f+z*h,e[9]=j*o+k*i+w*x+z*M,e[10]=j*u+k*c+w*l+z*d,e[11]=j*a+k*p+w*v+z*q,e[12]=F*n+I*s+L*f+O*h,e[13]=F*o+I*i+L*x+O*M,e[14]=F*u+I*c+L*l+O*d,e[15]=F*a+I*p+L*v+O*q,e}function n(t,r,e){return e[0]=t[0]*r[0],e[1]=t[1]*r[0],e[2]=t[2]*r[0],e[3]=t[3]*r[0],e[4]=t[4]*r[1],e[5]=t[5]*r[1],e[6]=t[6]*r[1],e[7]=t[7]*r[1],e[8]=t[8]*r[2],e[9]=t[9]*r[2],e[10]=t[10]*r[2],e[11]=t[11]*r[2],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function o(t,r,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[0]*r[0]+t[4]*r[1]+t[8]*r[2]+t[12],e[13]=t[1]*r[0]+t[5]*r[1]+t[9]*r[2]+t[13],e[14]=t[2]*r[0]+t[6]*r[1]+t[10]*r[2]+t[14],e[15]=t[3]*r[0]+t[7]*r[1]+t[11]*r[2]+t[15],e}function u(t,r,e,n){var o=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);if(!o)return null;var u=e[0],a=e[1],s=e[2];1!==o&&(u*=o=1/o,a*=o,s*=o);var i=Math.sin(r),c=Math.cos(r),p=1-c,f=t[0],x=t[1],l=t[2],v=t[3],h=t[4],M=t[5],d=t[6],q=t[7],y=t[8],m=t[9],g=t[10],A=t[11],P=u*u*p+c,S=a*u*p+s*i,_=s*u*p-a*i,b=u*a*p-s*i,j=a*a*p+c,k=s*a*p+u*i,w=u*s*p+a*i,z=a*s*p-u*i,F=s*s*p+c;return r?t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=f*P+h*S+y*_,n[1]=x*P+M*S+m*_,n[2]=l*P+d*S+g*_,n[3]=v*P+q*S+A*_,n[4]=f*b+h*j+y*k,n[5]=x*b+M*j+m*k,n[6]=l*b+d*j+g*k,n[7]=v*b+q*j+A*k,n[8]=f*w+h*z+y*F,n[9]=x*w+M*z+m*F,n[10]=l*w+d*z+g*F,n[11]=v*w+q*z+A*F,n}function a(t,e,n,o){var u,a,s,i,c,p,f,x,l,v,h=t[0],M=t[1],d=t[2],q=n[0],y=n[1],m=n[2],g=e[0],A=e[1],P=e[2];return h===g&&M===A&&d===P?r(o):(f=h-e[0],x=M-e[1],l=d-e[2],u=y*(l*=v=1/Math.sqrt(f*f+x*x+l*l))-m*(x*=v),a=m*(f*=v)-q*l,s=q*x-y*f,(v=Math.sqrt(u*u+a*a+s*s))?(u*=v=1/v,a*=v,s*=v):(u=0,a=0,s=0),i=x*s-l*a,c=l*u-f*s,p=f*a-x*u,(v=Math.sqrt(i*i+c*c+p*p))?(i*=v=1/v,c*=v,p*=v):(i=0,c=0,p=0),o[0]=u,o[1]=i,o[2]=f,o[3]=0,o[4]=a,o[5]=c,o[6]=x,o[7]=0,o[8]=s,o[9]=p,o[10]=l,o[11]=0,o[12]=-(u*h+a*M+s*d),o[13]=-(i*h+c*M+p*d),o[14]=-(f*h+x*M+l*d),o[15]=1,o)}function s(t,r,e,n,o){var u=e*Math.tan(t*Math.PI/360),a=2*(u*r),s=2*u,i=n-e;return o[0]=2*e/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*e/s,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-(n+e)/i,o[11]=-1,o[12]=0,o[13]=0,o[14]=-n*e*2/i,o[15]=0,o}function i(t,r,e,n,o,u,a){var s=r-t,i=e-n,c=u-o;return a[0]=2/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/c,a[11]=0,a[12]=-(t+r)/s,a[13]=-(e+n)/i,a[14]=-(u+o)/c,a[15]=1,a}function c(t,r){return r[0]=t[0],r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=t[1],r[5]=t[5],r[6]=t[9],r[7]=t[13],r[8]=t[2],r[9]=t[6],r[10]=t[10],r[11]=t[14],r[12]=t[3],r[13]=t[7],r[14]=t[11],r[15]=t[15],r}function p(t,r){var e=t[0],n=t[1],o=t[2],u=t[3],a=t[4],s=t[5],i=t[6],c=t[7],p=t[8],f=t[9],x=t[10],l=t[11],v=t[12],h=t[13],M=t[14],d=t[15],q=e*s-n*a,y=e*i-o*a,m=e*c-u*a,g=n*i-o*s,A=n*c-u*s,P=o*c-u*i,S=p*h-f*v,_=p*M-x*v,b=p*d-l*v,j=f*M-x*h,k=f*d-l*h,w=x*d-l*M,z=1/(q*w-y*k+m*j+g*b-A*_+P*S);return r[0]=(s*w-i*k+c*j)*z,r[1]=(-n*w+o*k-u*j)*z,r[2]=(h*P-M*A+d*g)*z,r[3]=(-f*P+x*A-l*g)*z,r[4]=(-a*w+i*b-c*_)*z,r[5]=(e*w-o*b+u*_)*z,r[6]=(-v*P+M*m-d*y)*z,r[7]=(p*P-x*m+l*y)*z,r[8]=(a*k-s*b+c*S)*z,r[9]=(-e*k+n*b-u*S)*z,r[10]=(v*A-h*m+d*q)*z,r[11]=(-p*A+f*m-l*q)*z,r[12]=(-a*j+s*_-i*S)*z,r[13]=(e*j-n*_+o*S)*z,r[14]=(-v*g+h*y-M*q)*z,r[15]=(p*g-f*y+x*q)*z,r}function f(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}function x(t){return v(t,f(t)||1)}function l(t,r){return t[0]*=r,t[1]*=r,t[2]*=r,t}function v(t,r){return l(t,1/r)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.createMatrix=t,exports.divideScalar=v,exports.getLength=f,exports.identity=r,exports.inverse=p,exports.lookAt=a,exports.multiply=e,exports.multiplyScalar=l,exports.normalize=x,exports.ortho=i,exports.perspective=s,exports.rotate=u,exports.scale=n,exports.translate=o,exports.transpose=c;
},{}],"d0Cm":[function(require,module,exports) {
"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&s(t,e)}function u(t){var e=p();return function(){var r,n=y(t);if(e){var o=y(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return c(this,r)}}function c(e,r){if(r&&("object"===t(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return i(e)}function i(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(t){var e="function"==typeof Map?new Map:void 0;return(f=function(t){if(null===t||!l(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return a(t,arguments,y(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s(r,t)})(t)}function a(t,e,r){return(a=p()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&s(o,r.prototype),o}).apply(null,arguments)}function p(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function l(t){return-1!==Function.toString.call(t).indexOf("[native code]")}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function y(t){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Vec4=exports.Vec3=exports.Vec2=void 0;var b=function(t){o(i,f(Array));var e=u(i);function i(t){var r;return n(this,i),t?c(r,t):c(r=e.call(this,2))}return r(i)}();exports.Vec2=b;var v=function(t){o(i,f(Array));var e=u(i);function i(t){var r;return n(this,i),t?c(r,t):c(r=e.call(this,3))}return r(i)}();exports.Vec3=v;var h=function(t){o(i,f(Array));var e=u(i);function i(t){var r;return n(this,i),t?c(r,t):c(r=e.call(this,4))}return r(i)}();exports.Vec4=h;
},{}],"KwgV":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("./minMatrix"),e=require("./vector");function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function s(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}var r=function(){function a(s){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];i(this,a),this.isProgram=!1,this.children=[],this.hasMatrix=!0,this.mMatrix=(0,t.createMatrix)(),this.mvpMatrix=(0,t.createMatrix)(),this._translate=new e.Vec3([0,0,0]),this._scale=new e.Vec3([1,1,1]),this._rotate=new e.Vec3([0,0,0]),this._scalePatch=1,this.isUpdateMatrix=!1,this.kgl=s,this.hasMatrix=n,this.hasMatrix&&("x"in r&&(this.x=r.x),"y"in r&&(this.y=r.y),"z"in r&&(this.z=r.z),"translate3d"in r&&(this.translate3d=r.translate3d),"scale"in r&&(this.scale=r.scale),"scaleX"in r&&(this.scaleX=r.scaleX),"scaleY"in r&&(this.scaleY=r.scaleY),"scaleZ"in r&&(this.scaleZ=r.scaleZ),"scale2d"in r&&(this.scale2d=r.scale2d),"scale3d"in r&&(this.scale3d=r.scale3d),"rotateX"in r&&(this.rotateX=r.rotateX),"rotateY"in r&&(this.rotateY=r.rotateY),"rotateZ"in r&&(this.rotateZ=r.rotateZ),"rotate"in r&&(this.rotate=r.rotate),"rotate3d"in r&&(this.rotate3d=r.rotate3d))}return s(a,[{key:"x",get:function(){return this._translate[0]},set:function(t){this._translate[0]=t,this.changeMatrix()}},{key:"y",get:function(){return this._translate[1]},set:function(t){this._translate[1]=t,this.changeMatrix()}},{key:"z",get:function(){return this._translate[2]},set:function(t){this._translate[2]=t,this.changeMatrix()}},{key:"translate3d",get:function(){return this._translate},set:function(t){this._translate[0]=t[0],this._translate[1]=t[1],this._translate[2]=t[2],this.changeMatrix()}},{key:"scale",get:function(){return this._scale[0]===this._scale[1]&&this._scale[0]===this._scale[2]?this._scale[0]:1},set:function(t){this._scale[0]=this._scale[1]=this._scale[2]=t,this.changeMatrix()}},{key:"scaleX",get:function(){return this._scale[0]},set:function(t){this._scale[0]=t,this.changeMatrix()}},{key:"scaleY",get:function(){return this._scale[1]},set:function(t){this._scale[1]=t,this.changeMatrix()}},{key:"scaleZ",get:function(){return this._scale[2]},set:function(t){this._scale[2]=t,this.changeMatrix()}},{key:"scale2d",get:function(){return this._scale},set:function(t){2===t.length?(this._scale[0]=t[0],this._scale[1]=t[1]):this._scale[0]=this._scale[1]=t,this.changeMatrix()}},{key:"scale3d",get:function(){return this._scale},set:function(t){3===t.length?(this._scale[0]=t[0],this._scale[1]=t[1],this._scale[2]=t[2]):this._scale[0]=this._scale[1]=this._scale[2]=t,this.changeMatrix()}},{key:"rotateX",get:function(){return this._rotate[0]},set:function(t){this._rotate[0]=t,this.changeMatrix()}},{key:"rotateY",get:function(){return this._rotate[1]},set:function(t){this._rotate[1]=t,this.changeMatrix()}},{key:"rotateZ",get:function(){return this._rotate[2]},set:function(t){this._rotate[2]=t,this.changeMatrix()}},{key:"rotate",get:function(){return this.rotateZ},set:function(t){this.rotateZ=t}},{key:"rotate3d",get:function(){return this._rotate},set:function(t){this._rotate[0]=t[0],this._rotate[1]=t[1],this._rotate[2]=t[2],this.changeMatrix()}},{key:"scalePatch",get:function(){return this._scalePatch},set:function(t){this._scalePatch=t,this.changeMatrix()}},{key:"changeMatrix",value:function(){this.isUpdateMatrix||this.kgl.setIsUpdateMatrix()}},{key:"setIsUpdateMatrix",value:function(){if(this.hasMatrix&&(this.isUpdateMatrix=!0,!this.isProgram))for(var t=0;t<this.children.length;t=t+1|0)this.children[t].setIsUpdateMatrix()}},{key:"updateMatrix",value:function(e){if(this.hasMatrix){var i=this.isUpdateMatrix;if(i){if((0,t.identity)(this.mMatrix),(0,t.translate)(this.mMatrix,[this._translate[0]*this.kgl.pixelRatio,this._translate[1]*this.kgl.pixelRatio,this._translate[2]],this.mMatrix),(0,t.rotate)(this.mMatrix,this._rotate[0],[1,0,0],this.mMatrix),(0,t.rotate)(this.mMatrix,this._rotate[1],[0,1,0],this.mMatrix),(0,t.rotate)(this.mMatrix,this._rotate[2],[0,0,1],this.mMatrix),(0,t.scale)(this.mMatrix,[this._scale[0]*this._scalePatch,this._scale[1]*this._scalePatch,this._scale[2]*this._scalePatch],this.mMatrix),(0,t.multiply)(e,this.mMatrix,this.mvpMatrix),!this.isProgram)for(var a=0;a<this.children.length;a=a+1|0)this.children[a].updateMatrix(this.mvpMatrix);this.isUpdateMatrix=!1}return i}}},{key:"add",value:function(t){this.children.push(t)}},{key:"remove",value:function(t){var e=this;this.children.some(function(i,a){return i===t&&(e.children.splice(a,1),!0)})}},{key:"draw",value:function(){if(this.children.length>0)for(var t=0;t<this.children.length;t=t+1|0)this.children[t].draw()}},{key:"forEachProgram",value:function(t){if(this.isProgram)t(this);else for(var e=0;e<this.children.length;e=e+1|0)this.children[e].forEachProgram(t)}}]),a}();exports.default=r;
},{"./minMatrix":"Je5E","./vector":"d0Cm"}],"C2us":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.attributeNone=void 0,exports.getShapeCube=r,exports.getShapeCylinder=s,exports.getShapePlane=o,exports.vertexShaderShape=void 0;var e=require("./minMatrix"),i=require("./vector"),t={d2:"attribute vec2 aPosition;void main(){gl_Position=vec4(aPosition,0.,1.);}",d3:"\n    attribute vec3 aPosition;\n    attribute vec2 aUv;\n    uniform mat4 uMvpMatrix;\n    varying vec2 vUv;\n    void main() {\n      vUv = aUv;\n      gl_Position = uMvpMatrix * vec4(aPosition, 1.);\n    }\n  "};exports.vertexShaderShape=t;var a={aPosition:{value:[-1,1,-1,-1,1,1,1,-1],size:2}};function o(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=i.width,a=void 0===t?1:t,o=i.height,r=void 0===o?1:o,s=i.hasLight,v=void 0!==s&&s;e.width=a,e.height=r;var n=a/2,u=r/2,h={aPosition:{value:[-n,u,0,-n,-u,0,n,u,0,n,-u,0],size:3},aUv:{value:[0,1,0,0,1,1,1,0],size:2}};return v&&(h.aNormal={value:[0,1,0,0,1,0,0,1,0,0,1,0],size:3}),{attributes:h,resolution:[a,r]}}function r(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=i.size,a=void 0===t?1:t,o=i.hasLight,r=void 0!==o&&o;e.size=a;var s=a/2,v={aPosition:{value:[s,s,-s,s,s,s,s,-s,s,s,-s,-s,-s,s,s,-s,s,-s,-s,-s,-s,-s,-s,s,-s,s,s,s,s,s,s,s,-s,-s,s,-s,-s,-s,-s,s,-s,-s,s,-s,s,-s,-s,s,s,s,s,-s,s,s,-s,-s,s,s,-s,s,-s,s,-s,s,s,-s,s,-s,-s,-s,-s,-s],size:3},aUv:{value:[1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0],size:2},indices:{value:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],isIndices:!0}};return r&&(v.aNormal={value:[1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1],size:3}),{attributes:v,resolution:[a,a]}}function s(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=a.radius,r=void 0===o?1:o,s=a.radiusTop,v=void 0===s?r:s,n=a.radiusBottom,u=void 0===n?r:n,h=a.height,d=void 0===h?1:h,p=a.radialSegments,l=void 0===p?8:p,g=a.heightSegments,c=void 0===g?1:g,f=a.openEnded,m=void 0===f||f,P=a.thetaStart,x=void 0===P?0:P,z=a.thetaLength,S=void 0===z?2*Math.PI:z,M=a.hasLight,b=void 0!==M&&M;t.radius=r,t.radiusTop=v,t.radiusBottom=u,t.height=d,t.radialSegments=l,t.heightSegments=c,t.openEnded=m,t.thetaStart=x,t.thetaLength=S;var U=[],L=[],N=[],I=[],_=0,w=[],y=d/2;function q(e){for(var i=_,t=e?v:u,a=e?1:-1,o=1;o<=l;o++)L.push(0,y*a,0),N.push(0,a,0),I.push(.5,.5),_++;for(var r=_,s=0;s<=l;s++){var n=s/l*S+x,h=Math.cos(n),d=Math.sin(n);L.push(t*d,y*a,t*h),N.push(0,a,0),I.push(.5*h+.5,.5*d*a+.5),_++}for(var p=0;p<l;p++){var g=i+p,c=r+p;e?U.push(c,c+1,g):U.push(c+1,c,g)}}!function(){for(var t=(u-v)/d,a=0;a<=c;a++){for(var o=[],r=a/c,s=r*(u-v)+v,n=0;n<=l;n++){var h=n/l,p=h*S+x,g=Math.sin(p),f=Math.cos(p);if(L.push(s*g,-r*d+y,s*f),b){var m=new i.Vec3([g,t,f]);(0,e.normalize)(m),N.push(m[0],m[1],m[2])}I.push(h,1-r),o.push(_++)}w.push(o)}for(var P=0;P<l;P++)for(var z=0;z<c;z++){var M=w[z][P],q=w[z+1][P],B=w[z+1][P+1],C=w[z][P+1];U.push(M,q,C),U.push(q,B,C)}}(),!1===m&&(v>0&&q(!0),u>0&&q(!1));var B={aPosition:{value:L,size:3},aUv:{value:I,size:2},indices:{value:U,isIndices:!0}};return b&&(B.aNormal={value:N,size:3}),{attributes:B,resolution:[2*r*Math.PI,d]}}exports.attributeNone=a;
},{"./minMatrix":"Je5E","./vector":"d0Cm"}],"wjyj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=i(require("./object")),t=require("./minMatrix"),r=require("./shape");function i(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=c(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?e:r):a.value}}).apply(this,arguments)}function c(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){var t=v();return function(){var r,i=b(e);if(t){var a=b(this).constructor;r=Reflect.construct(i,arguments,a)}else r=i.apply(this,arguments);return f(this,r)}}function f(e,t){if(t&&("object"===a(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return g(e)}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var E=function(i){l(c,e.default);var s=d(c);function c(e){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,c);var o=a.shape,u=a.vertexShaderId,l=a.vertexShader,h=void 0===l?u&&document.getElementById(u)&&document.getElementById(u).textContent?document.getElementById(u).textContent:o?r.vertexShaderShape.d3:r.vertexShaderShape.d2:l,d=a.fragmentShaderId,v=a.fragmentShader,b=void 0===v?d&&document.getElementById(d)&&document.getElementById(d).textContent?document.getElementById(d).textContent:"":v,E=a.attributes,m=a.instancedAttributes,x=a.uniforms,y=void 0===x?{}:x,p=a.mode,A=void 0===p?"point"===o?"POINTS":void 0:p,T=a.drawType,R=void 0===T?"STATIC_DRAW":T,_=a.isTransparent,S=void 0!==_&&_,I=a.isAdditive,k=void 0!==I&&I,P=a.isFloats,L=void 0!==P&&P,C=a.isCulling,M=void 0===C||C,O=a.isDepth,U=void 0!==O&&O,w=a.isHidden,D=void 0!==w&&w,N=a.isAutoResolution,B=void 0===N?!L&&!y.uResolution:N,F=a.hasCamera,j=void 0===F?!L&&e.hasCamera:F,G=a.hasLight,H=void 0===G?!L&&e.hasLight:G,X=!(a.shape||a.vertexShaderId||a.vertexShader),Y=!X&&j;(i=s.call(this,e,a,Y)).isProgram=!0,i.isPoint=!1,i.attributes={},i.uniforms={},i.textures={},i.kglTextures=[],i.id=-1,i.vertexShader=null,i.fragmentShader=null,i.program=null,i.data={},i.isProgram=!0,i.isPoint="point"===o,i.attributes={},i.uniforms={},i.textures={};var z=e.gl;if(i.gl=z,i.kglTextures=e.textures,e.indexProgram=e.indexProgram+1,i.id=e.indexProgram,H&&(i.invMatrix=(0,t.createMatrix)()),i.mode=A,i.glMode=i.gl[A||"TRIANGLE_STRIP"],i.drawType=R,i.isTransparent=S,i.isAdditive=k,i.isAutoResolution=B,i.hasCamera=j,i.hasLight=H,i.isCulling=M,i.isDepth=U,i.isInstanced=!!m,i.isHidden=D,i.createProgram(h,b),i.use(),X)i.createAttribute(r.attributeNone);else if(o&&"point"!==o){var q;switch(o){case"plane":q=(0,r.getShapePlane)(g(i),{hasLight:i.hasLight,width:a.width,height:a.height});break;case"cube":q=(0,r.getShapeCube)(g(i),{hasLight:i.hasLight,size:a.size});break;case"cylinder":q=(0,r.getShapeCylinder)(g(i),Object.assign({hasLight:i.hasLight},a))}q&&(i.createAttribute(q.attributes),y.uResolutionShape=q.resolution)}else E&&i.createAttribute(E);if(i.isInstanced&&m){var V=i.gl.getExtension("ANGLE_instanced_arrays");if(null==V)return alert("ANGLE_instanced_arrays not supported"),f(i);i.instancedArraysExt=V,i.createAttribute(m,!0)}return i.createUniform(y),a.data&&(i.data=a.data),i}return o(c,[{key:"createProgram",value:function(e,t){var r=this.gl,i=r.createProgram(),a=this.createShader("VERTEX_SHADER",e);if(a){r.attachShader(i,this.vertexShader=a);var n=this.createShader("FRAGMENT_SHADER",t);n&&(r.attachShader(i,this.fragmentShader=n),r.linkProgram(i),r.getProgramParameter(i,r.LINK_STATUS)?i?this.program=i:console.error("Failed to create program."):console.error(r.getProgramInfoLog(i)))}}},{key:"createShader",value:function(e,t){var r=this.gl,i=r.createShader(r[e]);if(r.shaderSource(i,t),r.compileShader(i),r.getShaderParameter(i,r.COMPILE_STATUS))return i;console.error(r.getShaderInfoLog(i))}},{key:"createAttribute",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object.keys(e).forEach(function(i){var a=e[i],n=a.value,s=a.size,o=a.isIndices;t.addAttribute(i,n,s,o,r)})}},{key:"addAttribute",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=this.gl,s={location:n.getAttribLocation(this.program,e),size:r,isInstanced:a};if(i){var o=n.createBuffer();n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o),n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Int16Array(t),n[this.drawType]),s.ibo=o,this.indicesCount=this.indicesCount||t.length,this.glMode=n[this.mode||"TRIANGLES"]}else{var u=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,u),n.bufferData(n.ARRAY_BUFFER,new Float32Array(t),n[this.drawType]),s.vbo=u,a&&(this.instanceCount=this.instanceCount||t.length/r),this.count=this.count||t.length/r}this.attributes[e]=s}},{key:"setAttribute",value:function(e){var t=this.gl,r=this.attributes[e],i=r.location,a=r.size,n=r.vbo,s=r.ibo,o=r.isInstanced;s?t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s):n&&(t.bindBuffer(t.ARRAY_BUFFER,n),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,a,t.FLOAT,!1,0,0),o&&this.instancedArraysExt.vertexAttribDivisorANGLE(i,1))}},{key:"updateAttribute",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,this.attributes[e].vbo),i.bufferSubData(i.ARRAY_BUFFER,r,new Float32Array(t))}},{key:"updateMatrix",value:function(e){if(this.hasMatrix){var r=u(b(c.prototype),"updateMatrix",this).call(this,e);if(r)return this.hasCamera&&(this.uniforms.uMvpMatrix=this.mvpMatrix),this.hasLight&&((0,t.inverse)(this.mMatrix,this.invMatrix),this.uniforms.uInvMatrix=this.invMatrix),r}}},{key:"createUniform",value:function(e){var t=this,r=Object.assign({},e);this.isAutoResolution&&!r.uResolution&&(r.uResolution=[1,1]),this.hasCamera&&(r.uMvpMatrix=new Float32Array(16)),this.hasLight&&(r.uInvMatrix=new Float32Array(16),r.uLightDirection||(r.uLightDirection=[0,0,0]),r.uEyeDirection||(r.uEyeDirection=[0,0,0]),r.uAmbientColor||(r.uAmbientColor=[.1,.1,.1])),this.isPoint&&(r.uPixelRatio=this.kgl.pixelRatio),Object.keys(r).forEach(function(e){t.addUniform(e,r[e])})}},{key:"addUniform",value:function(e,t){var r,i,n=this,s=t,o=function(t,a){switch(t){case"texture":r="texture",i="1i",s=n.createTexture(e,n._dummyCanvas||(n._dummyCanvas=document.createElement("canvas")));break;case"framebuffer":r="framebuffer",i="1i",s=a;break;default:i=t,s=a}};switch(a(t)){case"number":i="1f";break;case"boolean":i="1i";break;case"string":o(t);break;case"object":switch(t.constructor.name){case"Float32Array":case"Array":switch(t.length){case 16:r="matrix",i="Matrix4fv";break;default:i="".concat(t.length,"fv")}break;case"HTMLImageElement":case"HTMLVideoElement":case"HTMLCanvasElement":r="texture",i="1i",s=this.createTexture(e,t);break;case"Object":o(t.type,t.value)}}if(i){var u,c=this.gl.getUniformLocation(this.program,e),l="uniform".concat(i);switch(r){case"texture":u=function(t){switch(n.use(),a(t)){case"number":n.gl[l](c,t),s=t;break;case"string":s=n.textures[t].textureIndex,n.gl[l](c,s);break;default:s=n.updateTexture(e,t)}};break;case"framebuffer":u=function(e){n.use(),n.gl[l](c,n.kgl.framebuffers[e].textureIndex),s=e};break;case"matrix":u=function(e){n.use(),n.gl[l](c,!1,e),s=e};break;default:u=function(e){n.use(),n.gl[l](c,e),s=e}}Object.defineProperty(this.uniforms,e,{get:function(){return s},set:u}),void 0!==s&&(this.uniforms[e]=s)}else console.error('Failed to add uniform "'.concat(e,'".'))}},{key:"updateUniforms",value:function(e){for(var t=Object.keys(e),r=0;r<t.length;r++){var i=t[r];this.uniforms[i]=e[i]}}},{key:"createTexture",value:function(e,t){if(t){var r,i,a=this.gl,n=this.kglTextures.filter(function(e){var r=e.src;return t.currentSrc===r})[0];if(n)r=n.texture,i=n.textureIndex;else{r=a.createTexture();var s=this.kglTextures.filter(function(e){return!e.isActive})[0],o=s?s.textureIndex:-1;i=o>=0?o:++this.kgl.textureIndex,this.kglTextures[i]={isActive:!0,texture:r,textureIndex:i,src:t.currentSrc}}return this.textures[e]={texture:r,textureIndex:i},a.activeTexture(a.TEXTURE0+i),a.bindTexture(a.TEXTURE_2D,r),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t),i}}},{key:"updateTexture",value:function(e,t){var r=this.gl,i=this.textures[e].textureIndex;return r.activeTexture(r.TEXTURE0+i),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t),i}},{key:"use",value:function(){this.id!==this.kgl.currentProgramId&&(this.gl.useProgram(this.program),this.kgl.currentProgramId=this.id)}},{key:"visible",value:function(){this.isHidden=!1}},{key:"hidden",value:function(){this.isHidden=!0}},{key:"draw",value:function(){if(!this.isHidden){var e=this.gl;this.isUpdateMatrix&&this.kgl.updateMatrix(),this.use(),this.isTransparent?(e.enable(e.BLEND),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)):this.isAdditive?(e.enable(e.BLEND),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE,e.ONE,e.ONE)):e.disable(e.BLEND),this.isCulling?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.isDepth?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST);for(var t=Object.keys(this.attributes),r=0;r<t.length;r++)this.setAttribute(t[r]);this.isInstanced?this.indicesCount?this.instancedArraysExt.drawElementsInstancedANGLE(this.glMode,this.indicesCount,e.UNSIGNED_SHORT,0,this.instanceCount):this.instancedArraysExt.drawArraysInstancedANGLE(this.glMode,0,this.count,this.instanceCount):this.indicesCount?e.drawElements(this.glMode,this.indicesCount,e.UNSIGNED_SHORT,0):e.drawArrays(this.glMode,0,this.count)}}},{key:"destroy",value:function(){var e=this,t=this.gl;t.deleteShader(this.vertexShader),t.deleteShader(this.fragmentShader),Object.keys(this.attributes).forEach(function(r){var i=e.attributes[r],a=i.vbo,n=i.ibo;t.deleteBuffer(a||n)}),Object.keys(this.textures).forEach(function(r){var i=e.textures[r],a=i.texture,n=i.textureIndex;t.deleteTexture(a),e.kglTextures[n].isActive=!1}),t.deleteProgram(this.program)}}]),c}();exports.default=E;
},{"./object":"KwgV","./minMatrix":"Je5E","./shape":"C2us"}],"q8nz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("./minMatrix"),t=r(require("./object")),i=r(require("./program")),a=require("./vector");function r(e){return e&&e.__esModule?e:{default:e}}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function h(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var u=function(){function r(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s(this,r),this.indexProgram=-1,this.currentProgramId=-1,this.isUpdateMatrix=!1,this.framebuffers={},this.textureIndex=-1,this.textures=[],this.pixelRatio=1,this.vMatrix=(0,e.createMatrix)(),this.pMatrix=(0,e.createMatrix)(),this.vpMatrix=(0,e.createMatrix)(),this.fov=50,this.near=.1,this.far=2e3,this.aspect=1,this.cameraPosition=new a.Vec3([0,0,0]),this.cameraRotation=new a.Vec2([0,0]),this.extraFar=0,this.isAutoUpdateCameraPositionZ=!1,this.lightDirection=new a.Vec3([0,0,0]),this.eyeDirection=new a.Vec3([0,0,0]),this.ambientColor=new a.Vec3([0,0,0]),this.width=0,this.height=0,this.canvasNativeWidth=0,this.canvasNativeHeight=0;var n=i.canvas,h=i.disableClear,u=void 0!==h&&h,l=i.clearedColor,f=i.hasCamera,c=void 0!==f&&f,d=i.hasLight,E=void 0!==d&&d,v=i.isFullSize,R=void 0!==v&&v,m=i.stencil,x=void 0!==m&&m,T=i.alpha,p=void 0===T||T,F=i.premultipliedAlpha,b=void 0===F||F,g=i.pixelRatioMax,M=void 0===g?0:g,_=i.pixelRatioFixed,P=void 0===_?0:_;if(this.disableClear=u,this.clearedColor=l&&4===l.length?new a.Vec4(l):l||new a.Vec4([0,0,0,0]),this.hasCamera=c,this.hasLight=E,this.isFullSize=R,this.stencil=x,this.alpha=p,this.premultipliedAlpha=b,this.pixelRatioMax=M,this.pixelRatioFixed=P,c){var U=i.fov,A=void 0===U?50:U,y=i.near,D=void 0===y?.1:y,w=i.far,C=void 0===w?2e3:w,B=i.cameraPosition,N=void 0===B?[0,0,30]:B,I=i.cameraRotation,L=void 0===I?[0,0]:I,X=i.extraFar,O=void 0===X?1:X;this.fov=A,this.near=D,this.far=C,this.cameraPosition=N&&3===N.length?new a.Vec3(N):N,this.cameraRotation=L&&2===L.length?new a.Vec2(L):L,this.extraFar=O,this.isAutoUpdateCameraPositionZ=!("cameraPosition"in i||"far"in i)}if(E){var k=i.lightDirection,S=void 0===k?[-1,1,1]:k,H=i.eyeDirection,G=void 0===H?this.cameraPosition:H,W=i.ambientColor,V=void 0===W?[.1,.1,.1]:W;this.lightDirection=S&&3===S.length?new a.Vec3(S):S,this.eyeDirection=G&&3===G.length?new a.Vec3(G):G,this.ambientColor=V&&3===V.length?new a.Vec3(V):V}this.setPixelRatio(),this.root=new t.default(this);var j=n;"string"==typeof n&&(j=document.querySelector(n)),"object"===o(j)&&"HTMLCanvasElement"===j.constructor.name?this.canvas=j:(this.canvas=document.createElement("canvas"),this.canvas.style.display="block",this.canvas.style.width="100%",this.canvas.style.height="100%",document.body.appendChild(this.canvas));var z={alpha:this.alpha,depth:!0,stencil:this.stencil,antialias:!1,premultipliedAlpha:this.premultipliedAlpha,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1},q=this.gl=this.canvas.getContext("webgl",z)||this.canvas.getContext("experimental-webgl",z);q?q.depthFunc(q.LEQUAL):console.error("WebGL not support")}return h(r,[{key:"add",value:function(e){this.root.add(e),this.isAutoUpdateCameraPositionZ&&e.isProgram&&(e.scalePatch=this.pixelRatio)}},{key:"remove",value:function(e){this.root.remove(e)}},{key:"createProgram",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new i.default(this,e);return e.isAutoAdd&&this.add(t),t}},{key:"createGroup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=new t.default(this,e);return e.isAutoAdd&&this.add(i),i}},{key:"createFramebuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.canvas.width,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.canvas.height,a=this.gl,r=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,r);var o=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,o),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,t,i),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,o);var s=a.createTexture(),n=++this.textureIndex;a.activeTexture(a["TEXTURE".concat(n)]),a.bindTexture(a.TEXTURE_2D,s),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,t,i,0,a.RGBA,a.UNSIGNED_BYTE,null),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,s,0),a.bindRenderbuffer(a.RENDERBUFFER,null),a.bindFramebuffer(a.FRAMEBUFFER,null),this.framebuffers[e]={framebuffer:r,textureIndex:n,texture:s,depthRenderBuffer:o}}},{key:"resizeFramebuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.canvas.width,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.canvas.height,a=this.gl,r=this.framebuffers[e],o=r.framebuffer,s=r.textureIndex,n=r.depthRenderBuffer;r.isFloat||(a.bindFramebuffer(a.FRAMEBUFFER,o),a.bindRenderbuffer(a.RENDERBUFFER,n),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,t,i),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,n),a.activeTexture(a["TEXTURE".concat(s)]),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,t,i,0,a.RGBA,a.UNSIGNED_BYTE,null))}},{key:"createFramebufferFloat",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,a=this.gl,r=a.getExtension("OES_texture_float"),o=a.getExtension("OES_texture_half_float");if(r||o){var s=o?o.HALF_FLOAT_OES:a.FLOAT,n=a.createFramebuffer(),h=a.createTexture(),u=++this.textureIndex;a.bindFramebuffer(a.FRAMEBUFFER,n),a.activeTexture(a["TEXTURE".concat(u)]),a.bindTexture(a.TEXTURE_2D,h),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,t,i,0,a.RGBA,s,null),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,h,0),a.bindFramebuffer(a.FRAMEBUFFER,null),this.framebuffers[e]={framebuffer:n,textureIndex:u,texture:h,isFloat:!0}}else console.error("float texture not support")}},{key:"bindFramebuffer",value:function(e){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e?this.framebuffers[e].framebuffer:null)}},{key:"unbindFramebuffer",value:function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null)}},{key:"setPixelRatio",value:function(){this.pixelRatio=this.pixelRatioFixed>0?this.pixelRatioFixed:this.pixelRatioMax>0?Math.min(this.pixelRatioMax,window.devicePixelRatio):window.devicePixelRatio}},{key:"resize",value:function(){var e=this,t=this.gl;this.canvas.width="",this.canvas.height="",this.canvasNativeWidth=this.canvas.clientWidth,this.canvasNativeHeight=this.canvas.clientHeight,this.setPixelRatio();var i=this.pixelRatio;this.isAutoUpdateCameraPositionZ&&this.root.forEachProgram(function(t){t.scalePatch=e.pixelRatio});var a=Math.max(Math.min(window.innerWidth,window.outerWidth),this.canvasNativeWidth);this.width=this.isFullSize?a:this.canvasNativeWidth,this.height=this.isFullSize?Math.max(Math.min(window.innerHeight,window.outerHeight),this.canvasNativeHeight):this.canvasNativeHeight,this.root.scalePatch=this.height>this.width?this.width/this.height:1;var r=Math.floor(this.width*i),o=Math.floor(this.height*i);this.canvas.width=r,this.canvas.height=o,t.viewport(0,0,r,o),this.root.forEachProgram(function(t){t.isAutoResolution&&(t.uniforms.uResolution=[r,o]),t.isPoint&&(t.uniforms.uPixelRatio=e.pixelRatio)}),Object.keys(this.framebuffers).forEach(function(t){e.resizeFramebuffer(t)}),this.hasCamera&&(this.aspect=r/o,this.updateCamera()),this.hasLight&&this.updateLight()}},{key:"setIsUpdateMatrix",value:function(){this.isUpdateMatrix=!0,this.root.setIsUpdateMatrix()}},{key:"updateCamera",value:function(){var t=this.cameraPosition,i=this.cameraRotation,a=this.vMatrix,r=this.pMatrix,o=this.vpMatrix;this.isAutoUpdateCameraPositionZ&&(t[2]=Math.min(this.canvas.width,this.canvas.height)/2/Math.tan(this.fov/2*(Math.PI/180)),this.far=t[2]+this.extraFar),this.hasLight&&(this.eyeDirection=t),(0,e.lookAt)(t,[t[0],t[1],0],[0,1,0],a),(0,e.perspective)(this.fov,this.aspect,this.near,this.far,r),i[0]=i[0]%(2*Math.PI),i[1]=i[1]%(2*Math.PI),(0,e.rotate)(a,i[0],[0,1,0],a),(0,e.rotate)(a,i[1],[-1,0,0],a),(0,e.multiply)(r,a,o),this.setIsUpdateMatrix()}},{key:"updateLight",value:function(){var e=this.lightDirection,t=this.eyeDirection,i=this.ambientColor;this.root.forEachProgram(function(a){a.hasLight&&(a.uniforms.uLightDirection=e,a.uniforms.uEyeDirection=t,a.uniforms.uAmbientColor=i)})}},{key:"updateMatrix",value:function(){this.isUpdateMatrix&&(this.root.updateMatrix(this.vpMatrix),this.isUpdateMatrix=!1)}},{key:"clear",value:function(){var e=this.gl;e.clearColor(this.clearedColor[0],this.clearedColor[1],this.clearedColor[2],this.clearedColor[3]),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}},{key:"draw",value:function(){this.disableClear||this.clear(),this.root.forEachProgram(function(e){e.draw()})}},{key:"destroy",value:function(){var e,t=this,i=this.gl;Object.keys(this.framebuffers).forEach(function(e){var a=t.framebuffers[e],r=a.framebuffer,o=a.texture,s=a.depthRenderBuffer;i.deleteFramebuffer(r),i.deleteTexture(o),s&&i.deleteRenderbuffer(s)}),this.root.forEachProgram(function(e){e.destroy()}),null===(e=i.getExtension("WEBGL_lose_context"))||void 0===e||e.loseContext()}}]),r}();exports.default=u;
},{"./minMatrix":"Je5E","./object":"KwgV","./program":"wjyj","./vector":"d0Cm"}],"B62e":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=e(require("./kgl"));function e(t){return t&&t.__esModule?t:{default:t}}function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function i(){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=c(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}}).apply(this,arguments)}function c(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=b(t)););return t}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t){var e=y();return function(){var r,n=b(t);if(e){var o=b(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return s(this,r)}}function s(t,e){if(e&&("object"===r(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return p(t)}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function y(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var h=function(e){f(o,t.default);var r=a(o);function o(){var t;return n(this,o),(t=r.apply(this,arguments)).effectList=[],t}return u(o,[{key:"createEffect",value:function(t,e){var r=new t(this,e);return this.effectList.push(r),r}},{key:"resize",value:function(){var t=this;i(b(o.prototype),"resize",this).call(this),this.effectList.forEach(function(e){e.isAutoResolution&&(e.uniforms.uResolution=[t.canvas.width,t.canvas.height])})}}]),o}();exports.default=h;
},{"./kgl":"q8nz"}],"f5B0":[function(require,module,exports) {
module.exports="precision highp float;\n#define GLSLIFY 1\n\nuniform sampler2D uTexture;\nuniform vec2 uResolution;\nuniform float uRadius;\nuniform bool uIsHorizontal;\n\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main () {\n  vec2 uv = gl_FragCoord.xy / uResolution;\n  vec2 direction = uIsHorizontal ? vec2(1., 0.) : vec2(0., 1.);\n  direction *= uRadius;\n  gl_FragColor = blur9(uTexture, uv, uResolution, direction);\n}\n";
},{}],"nt0h":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=r(require("../program")),e=r(require("../shaders/postprocessing/blur.frag"));function r(t){return t&&t.__esModule?t:{default:t}}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,e,r){return e&&u(t.prototype,e),r&&u(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function f(){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=c(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}}).apply(this,arguments)}function c(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=d(t)););return t}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t){var e=b();return function(){var r,n=d(t);if(e){var o=d(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return p(this,r)}}function p(t,e){if(e&&("object"===n(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return y(t)}function y(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function b(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var h=function(r){a(u,t.default);var n=s(u);function u(t){var r;o(this,u);var i={fragmentShader:e.default,uniforms:{uTexture:"framebuffer",uRadius:0,uIsHorizontal:!1},hasCamera:!1,hasLight:!1};return(r=n.call(this,t,i)).radius=.5,r}return i(u,[{key:"drawEffect",value:function(t,e,r,n){for(var o=0;o<8;o++){this.kgl.bindFramebuffer(n&&o>=7?null:e),this.uniforms.uTexture=t,this.uniforms.uRadius=(7-o)*(void 0!==r?r:this.radius),this.uniforms.uIsHorizontal=o%2==0,this.kgl.clear(),f(d(u.prototype),"draw",this).call(this);var i=e;e=t,t=i}}}]),u}();exports.default=h;
},{"../program":"wjyj","../shaders/postprocessing/blur.frag":"f5B0"}],"aPJu":[function(require,module,exports) {
module.exports="precision highp float;\n#define GLSLIFY 1\n\nuniform vec2 uResolution;\nuniform sampler2D uTexture;\nuniform float uThreshold;\n\nvoid main() {\n  vec2 uv = gl_FragCoord.st / uResolution;\n  vec4 color = texture2D(uTexture, uv);\n  if (color.a == 0. || length(color.rgb) < uThreshold * 1.732) discard;\n  gl_FragColor = color;\n}\n";
},{}],"iMEo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=r(require("../program")),t=r(require("../shaders/postprocessing/specular.frag"));function r(e){return e&&e.__esModule?e:{default:e}}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function f(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var o=c(e,t);if(o){var n=Object.getOwnPropertyDescriptor(o,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}}).apply(this,arguments)}function c(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){var t=h();return function(){var r,o=b(e);if(t){var n=b(this).constructor;r=Reflect.construct(o,arguments,n)}else r=o.apply(this,arguments);return p(this,r)}}function p(e,t){if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return y(e)}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var d=function(r){l(u,e.default);var o=s(u);function u(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,u);var f=r.threshold,i=void 0===f?.5:f,c={fragmentShader:t.default,uniforms:{uTexture:"framebuffer",uThreshold:i},hasCamera:!1,hasLight:!1};return o.call(this,e,c)}return f(u,[{key:"drawEffect",value:function(e,t,r){this.kgl.bindFramebuffer(t),this.uniforms.uTexture=e,void 0!==r&&(this.uniforms.uThreshold=r),this.kgl.clear(),i(b(u.prototype),"draw",this).call(this)}}]),u}();exports.default=d;
},{"../program":"wjyj","../shaders/postprocessing/specular.frag":"aPJu"}],"iAUv":[function(require,module,exports) {
module.exports="precision highp float;\n#define GLSLIFY 1\n\nuniform vec2 uResolution;\nuniform sampler2D uSpecular;\nuniform sampler2D uTextureRead;\n\nconst float brightness = 0.7;\nconst float spread = 0.3;\n\nvoid main() {\n  vec2 uv = gl_FragCoord.st / uResolution;\n  vec4 specularColor = texture2D(uSpecular, uv);\n  specularColor.rgb = pow(specularColor.rgb, vec3(1. - brightness));\n  specularColor.a = pow(specularColor.a, 1. - spread);\n  gl_FragColor = texture2D(uTextureRead, uv) + specularColor;\n  // gl_FragColor = vec4(vec3(specularColor.a), 1.); // * debug\n  // gl_FragColor = vec4(texture2D(uSpecular, uv).rgb, 1.); // * debug\n}\n";
},{}],"cOKC":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=n(require("../program")),t=n(require("./specular")),r=n(require("./blur")),o=n(require("../shaders/postprocessing/bloom.frag"));function n(e){return e&&e.__esModule?e:{default:e}}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function c(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var o=l(e,t);if(o){var n=Object.getOwnPropertyDescriptor(o,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}}).apply(this,arguments)}function l(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e){var t=h();return function(){var r,o=m(e);if(t){var n=m(this).constructor;r=Reflect.construct(o,arguments,n)}else r=o.apply(this,arguments);return b(this,r)}}function b(e,t){if(t&&("object"===u(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return d(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v=function(n){s(i,e.default);var u=y(i);function i(e){var n;f(this,i);var c={fragmentShader:o.default,uniforms:{uSpecular:"framebuffer",uTextureRead:"framebuffer"},isAdditive:!0,hasCamera:!1,hasLight:!1};return(n=u.call(this,e,c)).radius=.4,n.bloomSpecular=e.createEffect(t.default,{threshold:.3}),n.bloomBlur=e.createEffect(r.default),n}return c(i,[{key:"drawEffect",value:function(e,t,r,o,n){this.bloomSpecular.drawEffect(e,t),this.bloomBlur.drawEffect(t,r,void 0!==o?o:this.radius),this.kgl.bindFramebuffer(n?null:r),this.uniforms.uTextureRead=e,this.uniforms.uSpecular=t,a(m(i.prototype),"draw",this).call(this)}}]),i}();exports.default=v;
},{"../program":"wjyj","./specular":"iMEo","./blur":"nt0h","../shaders/postprocessing/bloom.frag":"iAUv"}],"KuNS":[function(require,module,exports) {
module.exports="precision highp float;\n#define GLSLIFY 1\n\nuniform sampler2D uTexture;\nuniform vec2 uResolution;\nuniform float uStrength;\nuniform vec2 uCenter;\n\nhighp float random(vec2 co)\n{\n    highp float a = 12.9898;\n    highp float b = 78.233;\n    highp float c = 43758.5453;\n    highp float dt= dot(co.xy ,vec2(a,b));\n    highp float sn= mod(dt,3.14);\n    return fract(sin(sn) * c);\n}\n\nconst float nFrag = 1. / 30.;\n\nvoid main () {\n  vec2 tFrag = 1. / uResolution;\n  vec3 destColor = vec3(0.);\n  float randomValue = random(vec2(12.9898, 78.233));\n  vec2 fc = gl_FragCoord.st;\n  vec2 fcc = fc - uCenter;\n  float totalWeight = 0.;\n\n  for (float i = 0.; i <= 30.; i++) {\n    float percent = (i + randomValue) * nFrag;\n    float weight = percent - percent * percent;\n    vec2 t = fc - fcc * percent * uStrength * nFrag;\n    destColor += texture2D(uTexture, t * tFrag).rgb * weight;\n    totalWeight += weight;\n  }\n  gl_FragColor = vec4(destColor / totalWeight, 1.);\n}\n";
},{}],"SXYO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=r(require("../program")),e=r(require("../shaders/postprocessing/zoomblur.frag"));function r(t){return t&&t.__esModule?t:{default:t}}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function f(t,e,r){return e&&u(t.prototype,e),r&&u(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function i(){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=c(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}}).apply(this,arguments)}function c(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=h(t)););return t}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&a(t,e)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t){var e=b();return function(){var r,n=h(t);if(e){var o=h(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return p(this,r)}}function p(t,e){if(e&&("object"===n(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return y(t)}function y(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function b(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var d=function(r){l(u,t.default);var n=s(u);function u(t){o(this,u);var r={fragmentShader:e.default,uniforms:{uTexture:"framebuffer",uStrength:5,uCenter:[t.canvas.width/2,t.canvas.height/2]}};return n.call(this,t,r)}return f(u,[{key:"drawEffect",value:function(t,e,r,n,o){this.kgl.bindFramebuffer(o?null:e),this.uniforms.uTexture=t,void 0!==r&&(this.uniforms.uStrength=r),void 0!==n&&(this.uniforms.uCenter=n),this.kgl.clear(),i(h(u.prototype),"draw",this).call(this)}}]),u}();exports.default=d;
},{"../program":"wjyj","../shaders/postprocessing/zoomblur.frag":"KuNS"}],"NlgT":[function(require,module,exports) {
module.exports="precision highp float;\n#define GLSLIFY 1\n\nuniform vec2 uResolution;\nuniform sampler2D uTexture;\nuniform sampler2D uTextureCache;\n\nvoid main() {\n  vec2 uv = gl_FragCoord.st / uResolution;\n  gl_FragColor = texture2D(uTexture, uv) + texture2D(uTextureCache, uv);\n}\n";
},{}],"tAQv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=u(require("../program")),t=u(require("./blur")),r=u(require("./specular")),o=u(require("./zoomblur")),n=u(require("../shaders/postprocessing/godray.frag"));function u(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function a(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function l(){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var o=s(e,t);if(o){var n=Object.getOwnPropertyDescriptor(o,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}}).apply(this,arguments)}function s(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=g(e)););return e}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){var t=v();return function(){var r,o=g(e);if(t){var n=g(this).constructor;r=Reflect.construct(o,arguments,n)}else r=o.apply(this,arguments);return b(this,r)}}function b(e,t){if(t&&("object"===f(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return h(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var m=function(u){p(i,e.default);var f=d(i);function i(e){var u;c(this,i);var a={fragmentShader:n.default,uniforms:{uTexture:"framebuffer",uTextureCache:"framebuffer"},isAdditive:!0};return(u=f.call(this,e,a)).radius=.02,u.godraySpecular=e.createEffect(r.default,{threshold:.75}),u.godrayZoomblur=e.createEffect(o.default),u.godrayBlur=e.createEffect(t.default),u}return a(i,[{key:"drawEffect",value:function(e,t,r,o,n,u,f){this.godraySpecular.drawEffect(e,r),this.godrayZoomblur.drawEffect(r,t,o,n),this.godrayBlur.drawEffect(t,r,void 0!==u?u:this.radius),this.kgl.bindFramebuffer(f?null:r),this.uniforms.uTexture=e,this.uniforms.uTextureCache=t,l(g(i.prototype),"draw",this).call(this)}}]),i}();exports.default=m;
},{"../program":"wjyj","./blur":"nt0h","./specular":"iMEo","./zoomblur":"SXYO","../shaders/postprocessing/godray.frag":"NlgT"}],"gGhW":[function(require,module,exports) {
module.exports="precision highp float;\n#define GLSLIFY 1\n\nuniform vec2 uResolution;\nuniform sampler2D uTexture;\n\nvoid main() {\n  gl_FragColor = texture2D(uTexture, gl_FragCoord.st / uResolution);\n}\n";
},{}],"HdCQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=u(require("../program")),t=u(require("./blur")),r=u(require("./specular")),o=u(require("./zoomblur")),n=u(require("../shaders/template/texture.frag"));function u(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function a(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function l(){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var o=p(e,t);if(o){var n=Object.getOwnPropertyDescriptor(o,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}}).apply(this,arguments)}function p(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){var t=v();return function(){var r,o=m(e);if(t){var n=m(this).constructor;r=Reflect.construct(o,arguments,n)}else r=o.apply(this,arguments);return b(this,r)}}function b(e,t){if(t&&("object"===f(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return h(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var g=function(u){s(i,e.default);var f=d(i);function i(e){var u;c(this,i);var a={fragmentShader:n.default,uniforms:{uTexture:"framebuffer"},isAdditive:!0};return(u=f.call(this,e,a)).radius=.02,u.godraySpecular=e.createEffect(r.default,{threshold:.75}),u.godrayZoomblur=e.createEffect(o.default),u.godrayBlur=e.createEffect(t.default),u}return a(i,[{key:"drawEffect",value:function(e,t,r,o,n,u,f){this.godraySpecular.drawEffect(e,r),this.godrayZoomblur.drawEffect(r,t,o,n),this.godrayBlur.drawEffect(t,r,void 0!==u?u:this.radius),this.kgl.bindFramebuffer(f?null:r),this.uniforms.uTexture=t,l(m(i.prototype),"draw",this).call(this)}}]),i}();exports.default=g;
},{"../program":"wjyj","./blur":"nt0h","./specular":"iMEo","./zoomblur":"SXYO","../shaders/template/texture.frag":"gGhW"}],"eIZ9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"Bloom",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(exports,"Blur",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(exports,"Godray",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(exports,"GodrayLight",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(exports,"Specular",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(exports,"Zoomblur",{enumerable:!0,get:function(){return u.default}});var e=l(require("./blur")),r=l(require("./specular")),t=l(require("./bloom")),u=l(require("./zoomblur")),o=l(require("./godray")),n=l(require("./godrayLight"));function l(e){return e&&e.__esModule?e:{default:e}}
},{"./blur":"nt0h","./specular":"iMEo","./bloom":"cOKC","./zoomblur":"SXYO","./godray":"tAQv","./godrayLight":"HdCQ"}],"Q1vk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=o(require("./kglEffect")),t=n(require("./effects/index"));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}function n(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in e)if("default"!==f&&Object.prototype.hasOwnProperty.call(e,f)){var c=i?Object.getOwnPropertyDescriptor(e,f):null;c&&(c.get||c.set)?Object.defineProperty(o,f,c):o[f]=e[f]}return o.default=e,n&&n.set(e,o),o}function o(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,r){return t&&c(e.prototype,t),r&&c(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=s(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(arguments.length<3?e:r):o.value}}).apply(this,arguments)}function s(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e){var t=b();return function(){var r,n=v(e);if(t){var o=v(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return h(this,r)}}function h(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return d(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var m=function(r){l(o,e.default);var n=y(o);function o(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};f(this,o),(e=n.call(this,r)).programs={},e.effects={},e.framebuffers={},e.ticks=[],e.requestID=0;var i=r.programs,c=void 0===i?{}:i,u=r.effects,a=void 0===u?[]:u,s=r.framebuffers,l=void 0===s?[]:s,p=r.framebufferFloats,y=void 0===p?{}:p,h=r.tick,b=r.onBefore,v=r.onResize,m=r.isAutoResize,O=void 0===m||m,w=r.isAutoStart,g=void 0===w||w;switch("function"==typeof h&&e.addTick(h),"function"==typeof v&&(e.onResize=v),Object.keys(c).forEach(function(t){var r=c[t],n=e.programs[t]=e.createProgram(r);r.isFloats||e.add(n)}),a.forEach(function(r){var n=r.charAt(0).toUpperCase()+r.slice(1);e.effects[r]=e.createEffect(t[n])}),O&&e._initResize(),l.constructor.name){case"Array":l.forEach(function(t){e.createFramebuffer(t)});break;case"Object":Object.keys(l).forEach(function(t){var r=l[t],n=r.width,o=r.height;e.createFramebuffer(t,n,o)})}return Object.keys(y).forEach(function(t){var r=y[t],n=r.width,o=r.height;e.createFramebufferFloat(t,n,o)}),"function"==typeof b&&b(d(e)),g&&e.start(),e}return u(o,[{key:"_initResize",value:function(){var e=this;this._resize=function(){e.resize(),e.onResize&&e.onResize()},this._resize(),window.addEventListener("resize",this._resize)}},{key:"addTick",value:function(e){this.ticks.push(e)}},{key:"start",value:function(){var e,t=this;requestAnimationFrame(function(t){e=t});this.requestID=requestAnimationFrame(function r(n){for(var o=.001*(n-e),i=0;i<t.ticks.length;i++)t.ticks[i](t,o);t.requestID=requestAnimationFrame(r)})}},{key:"stop",value:function(){this.requestID&&(cancelAnimationFrame(this.requestID),this.requestID=0)}},{key:"destroy",value:function(){this.stop(),this._resize&&window.removeEventListener("resize",this._resize),a(v(o.prototype),"destroy",this).call(this)}}]),o}();exports.default=m;
},{"./kglEffect":"B62e","./effects/index":"eIZ9"}],"fUdq":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e={KglEffect:!0,KglAuto:!0};Object.defineProperty(exports,"KglAuto",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(exports,"KglEffect",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return t.default}});var t=o(require("./kgl")),r=o(require("./kglEffect")),u=o(require("./kglAuto")),n=require("./effects/index");function o(e){return e&&e.__esModule?e:{default:e}}Object.keys(n).forEach(function(t){"default"!==t&&"__esModule"!==t&&(Object.prototype.hasOwnProperty.call(e,t)||t in exports&&exports[t]===n[t]||Object.defineProperty(exports,t,{enumerable:!0,get:function(){return n[t]}}))});
},{"./kgl":"q8nz","./kglEffect":"B62e","./kglAuto":"Q1vk","./effects/index":"eIZ9"}],"P7KZ":[function(require,module,exports) {
module.exports="precision highp float;\n#define GLSLIFY 1\n\nvoid main () {\n  gl_FragColor = vec4(vec3(0.), 1.);\n}\n";
},{}],"vn2o":[function(require,module,exports) {
module.exports="precision highp float;\n#define GLSLIFY 1\n\nuniform vec2 uSize;\n\nhighp float random(vec2 co)\n{\n    highp float a = 12.9898;\n    highp float b = 78.233;\n    highp float c = 43758.5453;\n    highp float dt= dot(co.xy ,vec2(a,b));\n    highp float sn= mod(dt,3.14);\n    return fract(sin(sn) * c);\n}\n\nvoid main () {\n  vec2 nPosition = gl_FragCoord.st / uSize * 2. - 1.;\n  vec4 position = vec4(\n    nPosition * uSize,\n    0.,\n    random(nPosition)\n  );\n  gl_FragColor = position;\n}\n";
},{}],"cUPJ":[function(require,module,exports) {
module.exports="precision highp float;\n#define GLSLIFY 1\n\nuniform vec2 uSize;\nuniform sampler2D uPrevVelocityTexture;\nuniform sampler2D uPrevPositionTexture;\n\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat snoise(vec3 v)\n  {\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289(i);\n  vec4 p = permute( permute( permute(\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n  }\n\nvec3 snoiseVec3( vec3 x ){\n\n  float s  = snoise(vec3( x ));\n  float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n  float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n  vec3 c = vec3( s , s1 , s2 );\n  return c;\n\n}\n\nvec3 curlNoise( vec3 p ){\n  \n  const float e = .1;\n  vec3 dx = vec3( e   , 0.0 , 0.0 );\n  vec3 dy = vec3( 0.0 , e   , 0.0 );\n  vec3 dz = vec3( 0.0 , 0.0 , e   );\n\n  vec3 p_x0 = snoiseVec3( p - dx );\n  vec3 p_x1 = snoiseVec3( p + dx );\n  vec3 p_y0 = snoiseVec3( p - dy );\n  vec3 p_y1 = snoiseVec3( p + dy );\n  vec3 p_z0 = snoiseVec3( p - dz );\n  vec3 p_z1 = snoiseVec3( p + dz );\n\n  float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n  float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n  float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n\n  const float divisor = 1.0 / ( 2.0 * e );\n  return normalize( vec3( x , y , z ) * divisor );\n\n}\n\nconst float speed = 2.;\nconst float density = 0.007;\nconst float ease = 0.02;\n\nvoid main () {\n  vec2 uv = gl_FragCoord.st / uSize;\n  vec4 velocity = texture2D(uPrevVelocityTexture, uv);\n  vec3 prevPosition = texture2D(uPrevPositionTexture, uv).xyz;\n  velocity.xyz += curlNoise(prevPosition * density) * speed;\n  velocity.xyz *= velocity.w;\n  if (velocity.w > 0.01) {\n    velocity.w -= velocity.w * ease;\n  } else {\n    velocity.w = 1.;\n  }\n  gl_FragColor = velocity;\n}\n";
},{}],"N5wX":[function(require,module,exports) {
module.exports="precision highp float;\n#define GLSLIFY 1\n\nuniform vec2 uSize;\nuniform sampler2D uPrevPositionTexture;\nuniform sampler2D uVelocityTexture;\n\nvoid main () {\n  vec2 uv = gl_FragCoord.st / uSize;\n  vec4 prevPosition = texture2D(uPrevPositionTexture, uv);\n  vec4 velocity = texture2D(uVelocityTexture, uv);\n\n  vec3 position;\n  if (velocity.w == 1.) {\n    vec2 nPosition = uv * 2. - 1.;\n    position = vec3(nPosition * uSize, 0.);\n  } else {\n    position = prevPosition.xyz + velocity.xyz;\n  }\n\n  gl_FragColor = vec4(position, prevPosition.w);\n}\n";
},{}],"zHjc":[function(require,module,exports) {
module.exports="#define GLSLIFY 1\nattribute vec3 aPosition;\nattribute vec2 aUv;\nattribute vec3 aNormal;\nattribute vec2 aInstancedUv;\n\nuniform sampler2D uPositionTexture;\nuniform sampler2D uVelocityTexture;\nuniform mat4 uMvpMatrix;\nuniform mat4 uInvMatrix;\nuniform vec3 uLightDirection;\nuniform vec3 uAmbientColor;\nuniform vec3 uEyeDirection;\nuniform float uTime;\n\nvarying vec2 vUv;\nvarying vec4 vColor;\n\nmat3 rotateQ(vec3 axis, float rad) {\n    float hr = rad / 2.0;\n    float s = sin( hr );\n    vec4 q = vec4(axis * s, cos( hr ));\n    vec3 q2 = q.xyz + q.xyz;\n    vec3 qq2 = q.xyz * q2;\n    vec2 qx = q.xx * q2.yz;\n    float qy = q.y * q2.z;\n    vec3 qw = q.w * q2.xyz;\n\n    return mat3(\n        1.0 - (qq2.y + qq2.z),  qx.x - qw.z,            qx.y + qw.y,\n        qx.x + qw.z,            1.0 - (qq2.x + qq2.z),  qy - qw.x,\n        qx.y - qw.y,            qy + qw.x,              1.0 - (qq2.x + qq2.y)\n    );\n}\n\nhighp float random(vec2 co)\n{\n    highp float a = 12.9898;\n    highp float b = 78.233;\n    highp float c = 43758.5453;\n    highp float dt= dot(co.xy ,vec2(a,b));\n    highp float sn= mod(dt,3.14);\n    return fract(sin(sn) * c);\n}\n\nvec3 hsv(float h, float s, float v) {\n  vec4 t = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(vec3(h) + t.xyz) * 6.0 - vec3(t.w));\n  return v * mix(vec3(t.x), clamp(p - vec3(t.x), 0.0, 1.0), s);\n}\n\nconst float PI = 3.1415926;\n\nconst float PI2 = PI * 2.;\nconst float colorInterval = PI2 * 10.;\nconst float scale = 2.;\nconst float maxScaleRate = 1.4;\nconst float rotationSpeed = 100.;\nconst float minRotationSpeed = 0.1;\n\nvoid main () {\n  vec3 modelPosition = aPosition;\n  vec4 instancedPosition = texture2D(uPositionTexture, aInstancedUv);\n  float randomValue = instancedPosition.w;\n\n  float velocity = texture2D(uVelocityTexture, aInstancedUv).w;\n  float life = smoothstep(0.01, 0.04, velocity);\n\n  float cScale = scale;\n  cScale *= life;\n  cScale *= mix(1., maxScaleRate, (instancedPosition.z - 1.) * 0.01);\n  modelPosition *= cScale;\n\n  vec3 axis = normalize(vec3(\n    random(vec2(randomValue, 0.)),\n    random(vec2(0., randomValue)),\n    random(vec2(randomValue, 1.))\n  ));\n  float radian = PI2 * random(vec2(randomValue));\n  radian += velocity * mix(minRotationSpeed, rotationSpeed, randomValue);\n  mat3 rotate = rotateQ(axis, radian);\n  modelPosition *= rotate;\n\n  vec3 cNormal = normalize(aNormal);\n  cNormal *= rotate;\n  vec3 invLight = normalize(uInvMatrix * vec4(uLightDirection, 0.)).rgb;\n  vec3 invEye = normalize(uInvMatrix * vec4(uEyeDirection, 0.)).rgb;\n  vec3 halfLE = normalize(invLight + invEye);\n  float diffuse = clamp(dot(cNormal, invLight), 0.1, 1.);\n  float specular = pow(clamp(dot(cNormal, halfLE), 0., 1.), 50.);\n\n  vUv = aUv;\n\n  float colorNTime = mod(uTime, colorInterval) / colorInterval;\n  float alpha = 1.;\n  vColor = vec4(hsv(colorNTime * PI2, 0.25 + 0.7 * colorNTime, 0.85 + 0.1 * colorNTime), alpha);\n  vColor.rgb *= vec3(diffuse + specular);\n  vColor.rgb += uAmbientColor;\n  vColor.rgb *= mix(0.2, 1., clamp(((instancedPosition + 100.) / 200.).z, 0., 1.));\n  vColor.rgb *= life;\n\n  gl_Position = uMvpMatrix * (vec4(modelPosition + instancedPosition.xyz, 1.));\n}\n";
},{}],"imKV":[function(require,module,exports) {
module.exports="precision highp float;\n#define GLSLIFY 1\n\nvarying vec2 vUv;\nvarying vec4 vColor;\n\nvoid main () {\n  gl_FragColor = vColor;\n}\n";
},{}],"r8lD":[function(require,module,exports) {
"use strict";var e=require("../../../src/index"),r=n(require("../../kgl/instancing/shaders/reset-velocity.frag")),i=n(require("../../kgl/instancing/shaders/reset-position.frag")),t=n(require("../../kgl/instancing/shaders/velocity.frag")),a=n(require("../../kgl/instancing/shaders/position.frag")),o=n(require("../../kgl/instancing/shaders/main.vert")),s=n(require("../../kgl/instancing/shaders/main.frag"));function n(e){return e&&e.__esModule?e:{default:e}}for(var u=100,f=100,c=[u,f],l=[],m=0;m<u;m++)for(var d=0;d<f;d++)l.push(m/(u-1),1-d/(f-1));var g,h=0,p=h++%2;new e.KglAuto({clearedColor:[0,0,0,1],hasCamera:!0,hasLight:!0,cameraPosition:[0,0,480],fov:50,programs:{resetVelocity:{fragmentShader:r.default,isFloats:!0},resetPosition:{fragmentShader:i.default,uniforms:{uSize:c},isFloats:!0},velocity:{fragmentShader:t.default,uniforms:{uSize:c,uPrevVelocityTexture:"framebuffer",uPrevPositionTexture:"framebuffer"},isFloats:!0},position:{fragmentShader:a.default,uniforms:{uSize:c,uPrevPositionTexture:"framebuffer",uVelocityTexture:"framebuffer"},isFloats:!0},main:{shape:"cube",vertexShader:o.default,fragmentShader:s.default,instancedAttributes:{aInstancedUv:{value:l,size:2}},uniforms:{uPositionTexture:"framebuffer",uVelocityTexture:"framebuffer",uTime:0},isDepth:!0,isTransparent:!0}},framebufferFloats:{velocity0:{width:u,height:f},velocity1:{width:u,height:f},position0:{width:u,height:f},position1:{width:u,height:f}},onBefore:function(e){e.bindFramebuffer("velocity"+p),e.programs.resetVelocity.draw(),e.bindFramebuffer("position"+p),e.programs.resetPosition.draw()},tick:function(e,r){g=p,p=h++%2;var i="velocity".concat(g),t="position".concat(g),a="velocity".concat(p),o="position".concat(p);e.bindFramebuffer(a),e.programs.velocity.updateUniforms({uPrevVelocityTexture:i,uPrevPositionTexture:t}),e.programs.velocity.draw(),e.bindFramebuffer(o),e.programs.position.updateUniforms({uPrevPositionTexture:t,uVelocityTexture:a}),e.programs.position.draw(),e.unbindFramebuffer(),e.clear(),e.programs.main.updateUniforms({uPositionTexture:o,uVelocityTexture:a,uTime:r}),e.programs.main.draw()}});
},{"../../../src/index":"fUdq","../../kgl/instancing/shaders/reset-velocity.frag":"P7KZ","../../kgl/instancing/shaders/reset-position.frag":"vn2o","../../kgl/instancing/shaders/velocity.frag":"cUPJ","../../kgl/instancing/shaders/position.frag":"N5wX","../../kgl/instancing/shaders/main.vert":"zHjc","../../kgl/instancing/shaders/main.frag":"imKV"}]},{},["r8lD"], null)